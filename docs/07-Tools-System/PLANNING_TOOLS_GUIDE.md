# è®¡åˆ’ç®¡ç†å·¥å…·ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨4ä¸ªè®¡åˆ’ç®¡ç†å·¥å…·ï¼š`create_plan`ã€`update_plan`ã€`get_plan`ã€`list_plans`

## 1ï¸âƒ£ create_plan - åˆ›å»ºæ–°è®¡åˆ’

**ç”¨é€”**: ä¸ºç”¨æˆ·åˆ›å»ºæ–°çš„å­¦ä¹ /å·¥ä½œè®¡åˆ’ï¼ŒåŒ…å«æ€»ç›®æ ‡å’Œä»»åŠ¡åˆ—è¡¨

**å¿…å¡«å‚æ•°**:
- `title` (string): è®¡åˆ’æ ‡é¢˜
- `goal` (string): æ€»ç›®æ ‡æè¿°
- `tasks` (Task[]): ä»»åŠ¡æ•°ç»„

**Task ç»“æ„**:
```typescript
{
  title: string;            // ä»»åŠ¡æ ‡é¢˜
  estimated_hours: number;  // é¢„ä¼°å·¥æ—¶
  deadline: string;         // æˆªæ­¢æ—¥æœŸ (ISO 8601 æ ¼å¼)
  tags: string[];          // æ ‡ç­¾æ•°ç»„
}
```

**è°ƒç”¨ç¤ºä¾‹**:
```json
<tool_call>{
  "tool": "create_plan",
  "title": "ä¸‰ä¸ªæœˆ IELTS å¤‡è€ƒè®¡åˆ’",
  "goal": "åœ¨ 3 ä¸ªæœˆå†…å°† IELTS æ€»åˆ†æå‡åˆ° 7 åˆ†",
  "tasks": [
    {
      "title": "è¿›è¡Œç¬¬ä¸€æ¬¡å®Œæ•´æ¨¡è€ƒå¹¶è®°å½•åˆ†æ•°",
      "estimated_hours": 3,
      "deadline": "2025-01-05",
      "tags": ["mock", "baseline"]
    },
    {
      "title": "æ¯å¤©å®Œæˆ 2 ç¯‡é˜…è¯»ç»ƒä¹ ",
      "estimated_hours": 1.5,
      "deadline": "2025-01-31",
      "tags": ["reading"]
    }
  ]
}</tool_call>
```

**è¿”å›æ•°æ®**:
```json
{
  "plan_id": "uuid-generated",
  "title": "ä¸‰ä¸ªæœˆ IELTS å¤‡è€ƒè®¡åˆ’",
  "goal": "åœ¨ 3 ä¸ªæœˆå†…å°† IELTS æ€»åˆ†æå‡åˆ° 7 åˆ†",
  "tasks_count": 2,
  "created_at": "2025-11-26T10:00:00Z"
}
```

---

## 2ï¸âƒ£ update_plan - æ›´æ–°è®¡åˆ’

**ç”¨é€”**: ä¿®æ”¹å·²å­˜åœ¨çš„è®¡åˆ’å†…å®¹ï¼ˆæ ‡é¢˜/ç›®æ ‡/ä»»åŠ¡ï¼‰

**å¿…å¡«å‚æ•°**:
- `plan_id` (string): è®¡åˆ’ID

**å¯é€‰å‚æ•°**:
- `title` (string): æ–°çš„è®¡åˆ’æ ‡é¢˜
- `goal` (string): æ–°çš„æ€»ç›®æ ‡
- `tasks` (Task[]): æ–°çš„ä»»åŠ¡åˆ—è¡¨

**è°ƒç”¨ç¤ºä¾‹**:
```json
<tool_call>{
  "tool": "update_plan",
  "plan_id": "plan_123",
  "goal": "åœ¨ 4 ä¸ªæœˆå†…å°† IELTS æ€»åˆ†æå‡åˆ° 7 åˆ†ï¼ˆæ ¹æ®ç”¨æˆ·æ—¶é—´åšäº†è°ƒæ•´ï¼‰",
  "tasks": [
    {
      "title": "æ¯å¤©å®Œæˆ 1 ç¯‡é˜…è¯»ç»ƒä¹ ",
      "estimated_hours": 1,
      "deadline": "2025-02-15",
      "tags": ["reading"]
    }
  ]
}</tool_call>
```

**è¿”å›æ•°æ®**:
```json
{
  "plan_id": "plan_123",
  "title": "ä¸‰ä¸ªæœˆ IELTS å¤‡è€ƒè®¡åˆ’",
  "goal": "åœ¨ 4 ä¸ªæœˆå†…å°† IELTS æ€»åˆ†æå‡åˆ° 7 åˆ†",
  "tasks_count": 1,
  "updated_at": "2025-11-26T11:00:00Z"
}
```

---

## 3ï¸âƒ£ get_plan - è·å–è®¡åˆ’è¯¦æƒ…

**ç”¨é€”**: æŸ¥çœ‹æŒ‡å®šè®¡åˆ’çš„å®Œæ•´ä¿¡æ¯

**å¿…å¡«å‚æ•°**:
- `plan_id` (string): è®¡åˆ’ID

**è°ƒç”¨ç¤ºä¾‹**:
```json
<tool_call>{
  "tool": "get_plan",
  "plan_id": "plan_123"
}</tool_call>
```

**è¿”å›æ•°æ®**:
```json
{
  "plan_id": "plan_123",
  "title": "ä¸‰ä¸ªæœˆ IELTS å¤‡è€ƒè®¡åˆ’",
  "goal": "åœ¨ 3 ä¸ªæœˆå†…å°† IELTS æ€»åˆ†æå‡åˆ° 7 åˆ†",
  "tasks": [
    {
      "title": "è¿›è¡Œç¬¬ä¸€æ¬¡å®Œæ•´æ¨¡è€ƒå¹¶è®°å½•åˆ†æ•°",
      "estimated_hours": 3,
      "deadline": "2025-01-05",
      "tags": ["mock", "baseline"],
      "status": "pending"
    }
  ],
  "created_at": "2025-11-26T10:00:00Z",
  "updated_at": "2025-11-26T10:00:00Z"
}
```

---

## 4ï¸âƒ£ list_plans - åˆ—å‡ºæ‰€æœ‰è®¡åˆ’

**ç”¨é€”**: è·å–ç”¨æˆ·çš„æ‰€æœ‰è®¡åˆ’åˆ—è¡¨

**å¯é€‰å‚æ•°**:
- `limit` (number): é™åˆ¶è¿”å›æ•°é‡ï¼ˆé»˜è®¤10ï¼Œæœ€å¤§50ï¼‰

**è°ƒç”¨ç¤ºä¾‹**:
```json
<tool_call>{
  "tool": "list_plans",
  "limit": 10
}</tool_call>
```

**è¿”å›æ•°æ®**:
```json
{
  "plans": [
    {
      "plan_id": "plan_123",
      "title": "ä¸‰ä¸ªæœˆ IELTS å¤‡è€ƒè®¡åˆ’",
      "goal": "åœ¨ 3 ä¸ªæœˆå†…å°† IELTS æ€»åˆ†æå‡åˆ° 7 åˆ†",
      "tasks_count": 2,
      "created_at": "2025-11-26T10:00:00Z",
      "updated_at": "2025-11-26T11:00:00Z"
    }
  ],
  "total": 5,
  "limit": 10
}
```

---

## æŠ€æœ¯æ¶æ„

### æ•°æ®åº“
- **Collection**: `plans`
- **ç´¢å¼•**:
  - `planId` (unique)
  - `userId + updatedAt` (å¤åˆç´¢å¼•)
  - `userId + isActive` (å¤åˆç´¢å¼•)

### æ–‡ä»¶ç»“æ„
```
api/
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ models.ts          # Plan å’Œ Task æ¥å£å®šä¹‰
â”‚   â””â”€â”€ connection.ts      # æ•°æ®åº“ç´¢å¼•åˆ›å»º
â”œâ”€â”€ services/
â”‚   â””â”€â”€ planService.ts     # è®¡åˆ’ CRUD ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ toolValidator.ts   # å·¥å…·æ³¨å†Œå’ŒéªŒè¯
â”‚   â””â”€â”€ planningTools.ts   # 4ä¸ªå·¥å…·çš„å®ç°å’Œè·¯ç”±
â””â”€â”€ lambda/
    â””â”€â”€ chat.ts            # é›†æˆè®¡åˆ’å·¥å…·åˆ°èŠå¤©æµç¨‹
```

### å®‰å…¨ç‰¹æ€§
- âœ… **æƒé™æ§åˆ¶**: æ‰€æœ‰æ“ä½œéƒ½éœ€è¦ userIdï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è®¡åˆ’
- âœ… **å‚æ•°éªŒè¯**: toolValidator ä¸¥æ ¼éªŒè¯æ‰€æœ‰å‚æ•°ç±»å‹å’Œå¿…å¡«é¡¹
- âœ… **è½¯åˆ é™¤**: åˆ é™¤è®¡åˆ’æ—¶ä»…æ ‡è®° `isActive: false`
- âœ… **é˜²å¹»è§‰**: å·¥å…·è°ƒç”¨å‰ç»è¿‡éªŒè¯ï¼Œé˜²æ­¢æ¨¡å‹ç¼–é€ ä¸å­˜åœ¨çš„å·¥å…·

---

## ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1: ç”¨æˆ·æƒ³åˆ¶å®šå­¦ä¹ è®¡åˆ’
```
ç”¨æˆ·: "å¸®æˆ‘åˆ¶å®šä¸€ä¸ª3ä¸ªæœˆçš„IELTSå¤‡è€ƒè®¡åˆ’"

AI: <tool_call>{"tool": "create_plan", ...}</tool_call>

ç³»ç»Ÿè¿”å›: âœ… è®¡åˆ’åˆ›å»ºæˆåŠŸï¼åŒ…å« 5 ä¸ªä»»åŠ¡
```

### åœºæ™¯2: ç”¨æˆ·æƒ³ä¿®æ”¹è®¡åˆ’
```
ç”¨æˆ·: "æŠŠå¤‡è€ƒæ—¶é—´å»¶é•¿åˆ°4ä¸ªæœˆ"

AI: <tool_call>{"tool": "update_plan", "plan_id": "...", "goal": "..."}</tool_call>

ç³»ç»Ÿè¿”å›: âœ… è®¡åˆ’æ›´æ–°æˆåŠŸï¼
```

### åœºæ™¯3: ç”¨æˆ·æƒ³æŸ¥çœ‹æ‰€æœ‰è®¡åˆ’
```
ç”¨æˆ·: "æ˜¾ç¤ºæˆ‘æ‰€æœ‰çš„è®¡åˆ’"

AI: <tool_call>{"tool": "list_plans", "limit": 10}</tool_call>

ç³»ç»Ÿè¿”å›: ğŸ“‹ æ‰¾åˆ° 3 ä¸ªè®¡åˆ’ï¼ˆå…± 3 ä¸ªï¼‰
```

---

## å¼€å‘è€…æ³¨æ„äº‹é¡¹

1. **æ‰©å±•æ–°å·¥å…·**: åœ¨ `toolValidator.ts` çš„ `TOOL_REGISTRY` ä¸­æ³¨å†Œ
2. **å·¥å…·å®ç°**: åœ¨ `planningTools.ts` ä¸­æ·»åŠ  handler å‡½æ•°
3. **è·¯ç”±é›†æˆ**: åœ¨ `chat.ts` çš„ `executeToolCall` ä¸­æ·»åŠ åˆ¤æ–­åˆ†æ”¯
4. **æµ‹è¯•**: ç¡®ä¿å·¥å…·è°ƒç”¨ç»è¿‡ `validateToolCall` éªŒè¯

## ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ ä»»åŠ¡å®Œæˆåº¦è¿½è¸ª
- [ ] å®ç°è®¡åˆ’è¿›åº¦ç»Ÿè®¡
- [ ] æ”¯æŒè®¡åˆ’åˆ†äº«åŠŸèƒ½
- [ ] æ·»åŠ è®¡åˆ’æ¨¡æ¿åº“

