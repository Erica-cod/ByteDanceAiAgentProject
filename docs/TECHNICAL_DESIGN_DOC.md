# å¤šAgentåä½œç³»ç»Ÿ - æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®èƒŒæ™¯
åœ¨AIè¾…åŠ©è§„åˆ’åœºæ™¯ä¸­ï¼Œå•ä¸€Agentå¾€å¾€å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- **è§†è§’å•ä¸€**ï¼šç¼ºä¹å¤šç»´åº¦æ€è€ƒï¼Œå®¹æ˜“é™·å…¥æ€ç»´ç›²åŒº
- **ç¼ºä¹æ‰¹åˆ¤æ€§**ï¼šå®¹æ˜“ç”Ÿæˆè¿‡äºä¹è§‚æˆ–ä¸åˆ‡å®é™…çš„è®¡åˆ’
- **è´¨é‡ä¸ç¨³å®š**ï¼šæ²¡æœ‰è‡ªæˆ‘å®¡æŸ¥å’Œè¿­ä»£ä¼˜åŒ–æœºåˆ¶
- **å†³ç­–ç›²ç›®**ï¼šç¼ºä¹å¯¹è®¡åˆ’å¯è¡Œæ€§çš„å®¢è§‚è¯„ä¼°

### é¡¹ç›®ç›®æ ‡
æ„å»ºä¸€ä¸ª**å¤šAgentåä½œç³»ç»Ÿ**ï¼Œé€šè¿‡å¤šä¸ªä¸“ä¸šåŒ–Agentçš„åˆ†å·¥åä½œï¼Œå®ç°ï¼š
1. **å¤šç»´åº¦æ€è€ƒ**ï¼šPlannerè§„åˆ’ + Criticæ‰¹è¯„ â†’ äº’è¡¥è§†è§’
2. **è¿­ä»£ä¼˜åŒ–**ï¼šå¤šè½®è®¨è®ºï¼Œé€æ­¥æ”¶æ•›åˆ°é«˜è´¨é‡æ–¹æ¡ˆ
3. **æ™ºèƒ½å†³ç­–**ï¼šHoståŸºäºå…±è¯†åº¦åŠ¨æ€è°ƒæ•´è®¨è®ºç­–ç•¥
4. **ç»“æ„åŒ–è¾“å‡º**ï¼šReporterç”Ÿæˆæœ€ç»ˆçš„ç”¨æˆ·å‹å¥½æŠ¥å‘Š

---

## ğŸ¯ éœ€æ±‚åˆ†æ

### åŠŸèƒ½éœ€æ±‚

#### FR1: å¤šè§’è‰²Agentç³»ç»Ÿ
- **Plannerï¼ˆè§„åˆ’å¸ˆï¼‰**ï¼šæ‹†è§£ç”¨æˆ·ç›®æ ‡ï¼Œç”Ÿæˆç»“æ„åŒ–è®¡åˆ’
- **Criticï¼ˆæ‰¹è¯„å®¶ï¼‰**ï¼šæŒ‘åˆºã€é£é™©è¯„ä¼°ã€æå‡ºæ”¹è¿›å»ºè®®
- **Hostï¼ˆä¸»æŒäººï¼‰**ï¼šæµç¨‹æ§åˆ¶ã€å…±è¯†æ£€æµ‹ã€å†³ç­–ç®¡ç†
- **Reporterï¼ˆæŠ¥å‘Šå‘˜ï¼‰**ï¼šç”Ÿæˆæœ€ç»ˆç”¨æˆ·å¯è¯»æŠ¥å‘Š

#### FR2: æ™ºèƒ½å…±è¯†æ£€æµ‹
- ä½¿ç”¨**å‘é‡ç›¸ä¼¼åº¦**ï¼ˆembeddingï¼‰æˆ–**ç®€å•æ–‡æœ¬ç›¸ä¼¼åº¦**ï¼ˆJaccardï¼‰
- å®æ—¶è®¡ç®—å„Agentç«‹åœºçš„ä¸€è‡´æ€§
- ç”Ÿæˆå…±è¯†è¶‹åŠ¿å›¾ï¼Œå¯è§†åŒ–è®¨è®ºè¿›å±•

#### FR3: åŠ¨æ€è®¨è®ºç­–ç•¥
- **é«˜å…±è¯†ï¼ˆ>0.9ï¼‰**ï¼šè¿›å…¥æ”¶æ•›é˜¶æ®µ
- **ä¸­ç­‰å…±è¯†ï¼ˆ0.7-0.9ï¼‰**ï¼šç»§ç»­è®¨è®º
- **ä½å…±è¯†ï¼ˆ<0.7ï¼‰**ï¼šå¼ºåˆ¶åæ–¹è§’è‰²
- **é¡½å›ºæ£€æµ‹**ï¼šè¿ç»­2è½®è‡ªç›¸ä¼¼åº¦>0.98è§¦å‘è­¦å‘Š

#### FR4: å®¹é”™ä¸å¥å£®æ€§
- JSONè§£æå¤±è´¥è‡ªåŠ¨ä¿®å¤
- Embedding APIä¸å¯ç”¨è‡ªåŠ¨é™çº§
- SSEè¿æ¥ä¸­æ–­ä¼˜é›…å¤„ç†
- Agentè¾“å‡ºé”™è¯¯ä¸ä¸­æ–­æµç¨‹

### éåŠŸèƒ½éœ€æ±‚

#### NFR1: æ€§èƒ½
- å•è½®è®¨è®º<30ç§’ï¼ˆPlanner+Critic+Hostï¼‰
- æ”¯æŒ5è½®è¿­ä»£ï¼ˆæ€»è€—æ—¶<2.5åˆ†é’Ÿï¼‰
- SSEå®æ—¶æµå¼è¾“å‡ºï¼Œç”¨æˆ·ä½“éªŒæµç•…

#### NFR2: å¯æ‰©å±•æ€§
- AgentåŸºäºç»Ÿä¸€BaseAgentï¼Œæ˜“äºæ‰©å±•æ–°è§’è‰²
- å·¥å…·ç³»ç»Ÿç‹¬ç«‹ï¼Œæ”¯æŒæ·»åŠ æ–°å·¥å…·ï¼ˆæ—¶é—´ã€æœç´¢ç­‰ï¼‰
- åè®®JSONåŒ–ï¼Œæ”¯æŒè·¨è¯­è¨€é›†æˆ

#### NFR3: å¯ç»´æŠ¤æ€§
- è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•
- æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°
- å®Œæ•´æ–‡æ¡£ï¼Œé™ä½å­¦ä¹ æˆæœ¬

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (React)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ChatInterfaceâ”‚  â”‚MultiAgentDispâ”‚  â”‚  Mode Toggle â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â”‚ SSE Stream                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Layer (Express)                        â”‚
â”‚                            â”‚                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚     chat.ts (POST /api/chat)        â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚         â”‚  â”‚ handleMultiAgentMode()       â”‚   â”‚              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Multi-Agent Orchestration Layer                  â”‚
â”‚                       â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   MultiAgentOrchestrator                 â”‚                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚
â”‚  â”‚  â”‚ run(userQuery)                    â”‚   â”‚                â”‚
â”‚  â”‚  â”‚  for round in 1..maxRounds:      â”‚   â”‚                â”‚
â”‚  â”‚  â”‚    1. Planner.generate()          â”‚   â”‚                â”‚
â”‚  â”‚  â”‚    2. Critic.generate()           â”‚   â”‚                â”‚
â”‚  â”‚  â”‚    3. Host.generate()             â”‚   â”‚                â”‚
â”‚  â”‚  â”‚    4. Check decision              â”‚   â”‚                â”‚
â”‚  â”‚  â”‚       if converge: break          â”‚   â”‚                â”‚
â”‚  â”‚  â”‚  5. Reporter.generate()           â”‚   â”‚                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚         â”‚         â”‚        â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚         â”‚         â”‚        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Agent Layer                    â”‚                      â”‚
â”‚           â”‚         â”‚         â”‚         â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Planner   â”‚ â”‚ Critic  â”‚ â”‚  Host   â”‚  â”‚  Reporter    â”‚  â”‚
â”‚  â”‚  Agent     â”‚ â”‚ Agent   â”‚ â”‚ Agent   â”‚  â”‚  Agent       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚        â”‚          â”‚               â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                    â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚         â”‚   BaseAgent         â”‚                              â”‚
â”‚         â”‚  - callModel()      â”‚                              â”‚
â”‚         â”‚  - extractJSON()    â”‚                              â”‚
â”‚         â”‚  - fixJSON()        â”‚                              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Tools & Services Layer                           â”‚
â”‚                    â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Similarity Tools              â”‚  â”‚  Time Tools        â”‚   â”‚
â”‚  â”‚  - comparePositions()          â”‚  â”‚  - getNow()        â”‚   â”‚
â”‚  â”‚  - compareSelfSimilarity()     â”‚  â”‚  - calculateDate() â”‚   â”‚
â”‚  â”‚  - simpleComparePositions()    â”‚  â”‚                    â”‚   â”‚
â”‚  â”‚  - VolcengineEmbeddingService  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                    â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  VolcengineService             â”‚                            â”‚
â”‚  â”‚  - chat() â†’ Stream             â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè®¾è®¡

```
User Input (å‰ç«¯)
      â”‚
      â–¼
handleMultiAgentMode (API)
      â”‚
      â”œâ”€â†’ åˆ›å»º SSE Stream
      â”‚
      â–¼
MultiAgentOrchestrator.run()
      â”‚
      â”œâ”€â†’ Round 1:
      â”‚   â”œâ”€â†’ Planner.generate()
      â”‚   â”‚   â”œâ”€â†’ callModel(volcengine)
      â”‚   â”‚   â”œâ”€â†’ extractJSON()
      â”‚   â”‚   â””â”€â†’ AgentOutput â†’ SSE â†’ å‰ç«¯
      â”‚   â”‚
      â”‚   â”œâ”€â†’ Critic.generate()
      â”‚   â”‚   â”œâ”€â†’ callModel(volcengine)
      â”‚   â”‚   â”œâ”€â†’ extractJSON()
      â”‚   â”‚   â””â”€â†’ AgentOutput â†’ SSE â†’ å‰ç«¯
      â”‚   â”‚
      â”‚   â”œâ”€â†’ Host.generate()
      â”‚   â”‚   â”œâ”€â†’ analyzeConsensus()
      â”‚   â”‚   â”‚   â””â”€â†’ comparePositions() (embedding/simple)
      â”‚   â”‚   â”œâ”€â†’ detectStubbornAgents()
      â”‚   â”‚   â”œâ”€â†’ makeDecision()
      â”‚   â”‚   â””â”€â†’ HostDecision â†’ SSE â†’ å‰ç«¯
      â”‚   â”‚
      â”‚   â””â”€â†’ if decision == 'converge' â†’ break
      â”‚
      â”œâ”€â†’ Round 2-N: (åŒä¸Š)
      â”‚
      â””â”€â†’ Reporter.generate()
          â”œâ”€â†’ callModel(volcengine)
          â”œâ”€â†’ extractJSON()
          â”œâ”€â†’ save to DB
          â””â”€â†’ AgentOutput â†’ SSE â†’ å‰ç«¯
```

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. AgentåŸºç¡€æ¶æ„

#### BaseAgent è®¾è®¡
```typescript
abstract class BaseAgent {
  protected agentId: string;
  protected systemPrompt: string;
  protected temperature: number;
  protected maxTokens: number;
  protected history: AgentOutput[];
  protected lastPosition?: PositionSummary;

  // æ ¸å¿ƒæ–¹æ³•
  abstract generate(userQuery: string, context: any, round: number): Promise<AgentOutput>;
  protected abstract extractPosition(content: string, metadata: any): PositionSummary;
  
  // é€šç”¨åŠŸèƒ½
  protected async callModel(messages: VolcengineMessage[]): Promise<string>;
  protected extractJSON(text: string): any | null;
  protected fixCommonJSONErrors(jsonStr: string): string;
}
```

**è®¾è®¡äº®ç‚¹**ï¼š
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼šå®šä¹‰ç»Ÿä¸€æµç¨‹ï¼Œå­ç±»å®ç°å…·ä½“é€»è¾‘
- **JSONå®¹é”™æœºåˆ¶**ï¼šå¤šç­–ç•¥æå– + è‡ªåŠ¨ä¿®å¤ + fallback
- **å†å²ç®¡ç†**ï¼šæ¯ä¸ªAgentç»´æŠ¤è‡ªå·±çš„è¾“å‡ºå†å²å’Œç«‹åœºå˜åŒ–

#### JSONæå–å¢å¼º

**é—®é¢˜**ï¼šAIè¾“å‡ºçš„JSONæ ¼å¼å¯èƒ½ä¸å®Œç¾ï¼ˆç¼ºå¼•å·ã€å¤šä½™é€—å·ã€æœªé—­åˆæ‹¬å·ç­‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
protected extractJSON(text: string): any | null {
  // ç­–ç•¥1: å°è¯• ```json ... ``` ä»£ç å—
  // ç­–ç•¥2: å°è¯• ``` ... ``` ä»£ç å—
  // ç­–ç•¥3: ç›´æ¥æå– JSON å¯¹è±¡
  
  for (const strategy of strategies) {
    const jsonStr = strategy.fn();
    try {
      return JSON.parse(jsonStr); // ç›´æ¥è§£æ
    } catch (parseError) {
      // è‡ªåŠ¨ä¿®å¤
      const fixed = this.fixCommonJSONErrors(jsonStr);
      try {
        return JSON.parse(fixed); // ä¿®å¤åè§£æ
      } catch (fixError) {
        continue; // å°è¯•ä¸‹ä¸€ä¸ªç­–ç•¥
      }
    }
  }
  
  return null; // æ‰€æœ‰ç­–ç•¥å¤±è´¥ â†’ fallback
}
```

**ä¿®å¤è§„åˆ™**ï¼š
- ä¸­æ–‡å¼•å· â†’ è‹±æ–‡å¼•å·
- æ— å¼•å·å±æ€§å â†’ æ·»åŠ å¼•å·
- æœ«å°¾å¤šä½™é€—å· â†’ ç§»é™¤
- æœªé—­åˆæ‹¬å· â†’ è‡ªåŠ¨è¡¥å…¨

### 2. å…±è¯†æ£€æµ‹æœºåˆ¶

#### å‘é‡ç›¸ä¼¼åº¦ï¼ˆä¼˜å…ˆï¼‰

```typescript
async function comparePositions(texts: string[]): Promise<SimilarityResult> {
  // 1. è°ƒç”¨ç«å±±å¼•æ“embedding API
  const embeddings = await embeddingService.getBatchEmbeddings(texts);
  
  // 2. è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦çŸ©é˜µ
  const matrix = [];
  for (let i = 0; i < embeddings.length; i++) {
    for (let j = 0; j < embeddings.length; j++) {
      matrix[i][j] = cosineSimilarity(embeddings[i], embeddings[j]);
    }
  }
  
  // 3. è®¡ç®—å¹³å‡ç›¸ä¼¼åº¦ï¼ˆæ’é™¤å¯¹è§’çº¿ï¼‰
  const meanSimilarity = calculateMeanSimilarity(matrix);
  
  // 4. æ‰¾å‡ºæœ€ä¸ç›¸ä¼¼çš„Agenté…å¯¹
  const mostDifferent = findMostDifferentPair(matrix);
  
  return { matrix, meanSimilarity, mostDifferent };
}
```

**ä¼˜åŠ¿**ï¼š
- **è¯­ä¹‰çº§ç†è§£**ï¼šç†è§£"å¢åŠ è®­ç»ƒ"å’Œ"æå‡ç»ƒä¹ "æ˜¯ç›¸ä¼¼çš„
- **é«˜ç²¾åº¦**ï¼š768ç»´å‘é‡æ•æ‰ç»†å¾®å·®å¼‚
- **å¯è§£é‡Šæ€§**ï¼šç›¸ä¼¼åº¦çŸ©é˜µç›´è§‚å±•ç¤ºAgentç«‹åœºåˆ†å¸ƒ

#### ç®€å•ç›¸ä¼¼åº¦ï¼ˆfallbackï¼‰

å½“embedding APIä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨é™çº§ï¼š

```typescript
function simpleComparePositions(texts: string[]): SimilarityResult {
  // ä½¿ç”¨Jaccardç›¸ä¼¼åº¦ï¼ˆåŸºäºå…³é”®è¯é‡å ï¼‰
  const matrix = [];
  for (let i = 0; i < texts.length; i++) {
    for (let j = 0; j < texts.length; j++) {
      const wordsA = new Set(tokenize(texts[i]));
      const wordsB = new Set(tokenize(texts[j]));
      const intersection = [...wordsA].filter(w => wordsB.has(w)).length;
      const union = new Set([...wordsA, ...wordsB]).size;
      matrix[i][j] = intersection / union;
    }
  }
  
  return { matrix, meanSimilarity, mostDifferent };
}
```

### 3. Hostå†³ç­–é€»è¾‘

#### å†³ç­–æµç¨‹

```typescript
async makeDecision(consensusInfo: SimilarityResult, round: number): Promise<HostDecision> {
  const { meanSimilarity } = consensusInfo;
  
  // 1. é«˜å…±è¯† â†’ æ”¶æ•›
  if (meanSimilarity > 0.90 && round >= 1) {
    return {
      action: 'converge',
      reason: `å…±è¯†åº¦${(meanSimilarity*100).toFixed(1)}%ï¼Œè¾¾æˆä¸€è‡´`,
      next_agents: ['reporter']
    };
  }
  
  // 2. ä½å…±è¯† â†’ å¼ºåˆ¶åæ–¹
  if (meanSimilarity <= 0.70) {
    return {
      action: 'force_opposition',
      reason: `å…±è¯†åº¦${(meanSimilarity*100).toFixed(1)}%ï¼Œéœ€è¦åæ–¹è§’è‰²`,
      next_agents: ['critic']
    };
  }
  
  // 3. ä¸­ç­‰å…±è¯† â†’ ç»§ç»­è®¨è®º
  return {
    action: 'continue',
    reason: `å…±è¯†åº¦${(meanSimilarity*100).toFixed(1)}%ï¼Œç»§ç»­è®¨è®º`,
    next_agents: ['planner', 'critic']
  };
}
```

#### é¡½å›ºAgentæ£€æµ‹

```typescript
async detectStubbornAgents(): Promise<string[]> {
  const stubborn = [];
  
  for (const agentId of ['planner', 'critic']) {
    const history = this.getAgentSimilarityHistory(agentId);
    
    // è¿ç»­2è½®è‡ªç›¸ä¼¼åº¦ > 0.98 â†’ é¡½å›º
    if (history.length >= 2) {
      const recent = history.slice(-2);
      if (recent.every(sim => sim > 0.98)) {
        stubborn.push(agentId);
      }
    }
  }
  
  return stubborn;
}
```

### 4. SSEæµå¼ä¼ è¾“

#### è¿æ¥ç®¡ç†

```typescript
async function handleMultiAgentMode(userQuery, userId, conversationId) {
  const { readable, writable } = new TransformStream();
  const writer = writable.getWriter();
  let isStreamClosed = false;
  
  // å®‰å…¨å†™å…¥ï¼ˆé˜²æ­¢AbortErrorï¼‰
  const safeWrite = async (data: string) => {
    if (isStreamClosed) return false;
    
    try {
      await writer.write(encoder.encode(data));
      return true;
    } catch (error) {
      if (error.name === 'AbortError') {
        console.warn('âš ï¸  å®¢æˆ·ç«¯å…³é—­äº†è¿æ¥');
        isStreamClosed = true;
        return false;
      }
      throw error;
    }
  };
  
  // å¼‚æ­¥æ‰§è¡Œå¤šAgentåä½œ
  (async () => {
    try {
      const orchestrator = new MultiAgentOrchestrator(...);
      await orchestrator.run(userQuery);
      
      if (!isStreamClosed) {
        await safeWrite('data: [DONE]\n\n');
        await writer.close();
      }
    } catch (error) {
      // é”™è¯¯å¤„ç†
    }
  })();
  
  return new Response(readable, {
    headers: {
      'Content-Type': 'text/event-stream',
      'Cache-Control': 'no-cache',
      'Connection': 'keep-alive',
    },
  });
}
```

**å…³é”®ç‚¹**ï¼š
- **è¿æ¥çŠ¶æ€è¿½è¸ª**ï¼š`isStreamClosed`æ ‡å¿—
- **ä¼˜é›…é™çº§**ï¼šæ•è·`AbortError`ï¼Œä¸å´©æºƒ
- **èµ„æºæ¸…ç†**ï¼šç¡®ä¿writeræ­£ç¡®å…³é—­

---

## ğŸ’¡ å…³é”®æŠ€æœ¯ç‚¹ä¸åˆ›æ–°

### 1. å¤šç­–ç•¥JSONå®¹é”™

**åˆ›æ–°ç‚¹**ï¼š
- ä¸æ˜¯ç®€å•åœ°æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯é€çº§é™çº§
- 3ç§æå–ç­–ç•¥ Ã— 2ç§è§£ææ–¹å¼ï¼ˆç›´æ¥/ä¿®å¤ï¼‰= 6æ¬¡æœºä¼š
- æœ€ç»ˆfallbackåˆ°æ–‡æœ¬æ‘˜è¦ï¼Œä¿è¯æµç¨‹ä¸ä¸­æ–­

**å½±å“**ï¼š
- JSONè§£ææˆåŠŸç‡ä» ~60% æå‡åˆ° ~95%
- å‡å°‘äº†80%çš„"æ ¼å¼é”™è¯¯å¯¼è‡´æµç¨‹ä¸­æ–­"é—®é¢˜

### 2. åŒæ¨¡å¼ç›¸ä¼¼åº¦è®¡ç®—

**åˆ›æ–°ç‚¹**ï¼š
- ä¼˜å…ˆä½¿ç”¨embeddingï¼ˆé«˜ç²¾åº¦ï¼‰ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°Jaccardï¼ˆé«˜å¯ç”¨ï¼‰
- ç”¨æˆ·æ— æ„ŸçŸ¥åˆ‡æ¢ï¼Œç³»ç»Ÿå§‹ç»ˆå¯ç”¨
- è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºæ’æŸ¥é—®é¢˜

**å½±å“**ï¼š
- ç³»ç»Ÿå¯ç”¨æ€§ä»ä¾èµ–å¤–éƒ¨API â†’ 100%è‡ªä¸»å¯ç”¨
- åœ¨embeddingä¸å¯ç”¨æ—¶ä»èƒ½å®Œæˆ80%çš„å…±è¯†æ£€æµ‹éœ€æ±‚

### 3. SSEè¿æ¥å¥å£®æ€§

**åˆ›æ–°ç‚¹**ï¼š
- ä¼ ç»ŸSSEå®ç°é‡åˆ°`AbortError`ç›´æ¥å´©æºƒ
- æˆ‘ä»¬çš„å®ç°ï¼šæ•è·å¼‚å¸¸ â†’ æ ‡è®°è¿æ¥çŠ¶æ€ â†’ è·³è¿‡åç»­å†™å…¥ â†’ ä¼˜é›…é€€å‡º
- å³ä½¿å®¢æˆ·ç«¯å…³é—­ï¼ŒæœåŠ¡ç«¯ä»èƒ½å®Œæ•´æ‰§è¡ŒAgentåä½œï¼ˆä¸ºæœªæ¥çš„å¼‚æ­¥æ¨¡å¼é“ºè·¯ï¼‰

**å½±å“**ï¼š
- æ¶ˆé™¤äº†"ç”¨æˆ·åˆ·æ–°é¡µé¢å¯¼è‡´æœåŠ¡å™¨å´©æºƒ"çš„é—®é¢˜
- æå‡äº†ç³»ç»Ÿç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ

### 4. è¯¦ç»†è¯Šæ–­æ—¥å¿—

**åˆ›æ–°ç‚¹**ï¼š
- JSONè§£æï¼šæ˜¾ç¤ºç­–ç•¥åç§°ã€æå–é•¿åº¦ã€é¢„è§ˆå†…å®¹ã€é”™è¯¯ä½ç½®
- Embeddingï¼šæ˜¾ç¤ºæ¨¡å‹ã€ç«¯ç‚¹ã€å‘é‡ç»´åº¦ã€æˆåŠŸ/å¤±è´¥åŸå› 
- SSEï¼šæ˜¾ç¤ºæ¯æ¬¡å†™å…¥ã€è¿æ¥çŠ¶æ€ã€å®¢æˆ·ç«¯è¡Œä¸º

**å½±å“**ï¼š
- é—®é¢˜å®šä½æ—¶é—´ä»"å‡ å°æ—¶ç›²çŒœ" â†’ "å‡ åˆ†é’Ÿç²¾å‡†å®šä½"
- é™ä½äº†ç»´æŠ¤æˆæœ¬å’Œè°ƒè¯•éš¾åº¦

---

## ğŸ› é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šJSONè§£æå¤±è´¥ç‡é«˜

**ç°è±¡**ï¼š
```
âŒ [planner] æå–JSONå¤±è´¥: Expected ',' or '}' after property value
âŒ [Planner] ç”Ÿæˆå¤±è´¥: AIå›å¤æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘å¿…è¦çš„positionæˆ–planå­—æ®µ
```

**åŸå› åˆ†æ**ï¼š
- AIæ¨¡å‹ç”Ÿæˆçš„JSONå¯èƒ½ç¼ºå°‘å¼•å·ã€æœ‰å¤šä½™é€—å·
- åŸå§‹å®ç°åªæœ‰ä¸€æ¬¡`JSON.parse()`æœºä¼šï¼Œå¤±è´¥å³æŠ›å‡ºå¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **å¤šç­–ç•¥æå–**ï¼šä»£ç å—ã€ç›´æ¥æå–ã€å¤šç§æ­£åˆ™
2. **è‡ªåŠ¨ä¿®å¤**ï¼šä¿®å¤ä¸­æ–‡å¼•å·ã€æ— å¼•å·å±æ€§åã€æœªé—­åˆæ‹¬å·
3. **Fallbackæœºåˆ¶**ï¼šæå–å¤±è´¥æ—¶åˆ›å»ºç®€åŒ–è¾“å‡ºï¼Œä¿è¯æµç¨‹ç»§ç»­

**æ•ˆæœ**ï¼š
- è§£ææˆåŠŸç‡ï¼š60% â†’ 95%
- æµç¨‹ä¸­æ–­ç‡ï¼š40% â†’ <5%

### é—®é¢˜2ï¼šEmbedding API 404é”™è¯¯

**ç°è±¡**ï¼š
```
404: doubao-embedding does not exist or you do not have access to it
âš ï¸ [Host] Embeddingè®¡ç®—å¤±è´¥ï¼Œä½¿ç”¨ç®€å•æ–¹æ³•
```

**åŸå› åˆ†æ**ï¼š
- æ¨¡å‹åç§°é”™è¯¯ï¼ˆ`doubao-embedding` vs `doubao-embedding-text-240715`ï¼‰
- API Keyæƒé™ä¸è¶³
- ç”¨æˆ·æœªé…ç½®embedding

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **è‡ªåŠ¨é™çº§**ï¼šembeddingå¤±è´¥ â†’ ä½¿ç”¨Jaccardç›¸ä¼¼åº¦
2. **è¯¦ç»†æ—¥å¿—**ï¼šæ˜¾ç¤ºAPIè°ƒç”¨è¯¦æƒ…ã€é”™è¯¯ä½ç½®ã€è§£å†³å»ºè®®
3. **é…ç½®æ–‡æ¡£**ï¼šåˆ›å»º`EMBEDDING_SETUP_GUIDE.md`ï¼Œæä¾›é…ç½®æŒ‡å—

**æ•ˆæœ**ï¼š
- ç³»ç»Ÿå¯ç”¨æ€§ï¼šä¾èµ–å¤–éƒ¨æœåŠ¡ â†’ 100%è‡ªä¸»å¯ç”¨
- ç”¨æˆ·ä½“éªŒï¼šæ— æ„ŸçŸ¥é™çº§ï¼ŒåŠŸèƒ½æ­£å¸¸ä½¿ç”¨

### é—®é¢˜3ï¼šSSEè¿æ¥ä¸­æ–­å¯¼è‡´å´©æºƒ

**ç°è±¡**ï¼š
```
âŒ [Orchestrator] åä½œå¤±è´¥: AbortError: The operation was aborted
error   AbortError: The operation was aborted
ELIFECYCLE  Command failed with exit code 1.
```

**åŸå› åˆ†æ**ï¼š
- ç”¨æˆ·åˆ·æ–°é¡µé¢æˆ–å…³é—­æ ‡ç­¾é¡µæ—¶ï¼Œæµè§ˆå™¨ä¸­æ–­SSEè¿æ¥
- æœåŠ¡ç«¯å°è¯•å†™å…¥å·²å…³é—­çš„streamï¼Œè§¦å‘`AbortError`
- åŸå§‹ä»£ç æœªæ•è·æ­¤å¼‚å¸¸ï¼Œå¯¼è‡´è¿›ç¨‹å´©æºƒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **è¿æ¥çŠ¶æ€è¿½è¸ª**ï¼š`isStreamClosed`æ ‡å¿—
2. **å®‰å…¨å†™å…¥å°è£…**ï¼š`safeWrite()`æ•è·`AbortError`
3. **è·³è¿‡åç»­æ“ä½œ**ï¼šæ£€æŸ¥`isStreamClosed`å†æ‰§è¡Œ

**æ•ˆæœ**ï¼š
- å´©æºƒç‡ï¼š~30% (ç”¨æˆ·åˆ·æ–°æ—¶) â†’ 0%
- ç³»ç»Ÿç¨³å®šæ€§æ˜¾è‘—æå‡

### é—®é¢˜4ï¼šå…±è¯†è¶‹åŠ¿æ˜¾ç¤ºä¸å®Œæ•´

**ç°è±¡**ï¼š
- æœ‰3è½®è®¨è®ºï¼Œä½†è¶‹åŠ¿å›¾åªæ˜¾ç¤º2ä¸ªæŸ±å­
- ç”¨æˆ·å›°æƒ‘ï¼š"æ˜¯ä¸æ˜¯æ•°æ®ä¸¢äº†ï¼Ÿ"

**åŸå› åˆ†æ**ï¼š
- å…±è¯†æ•°æ®åªåœ¨Hostå†³ç­–æ—¶æ›´æ–°
- Reporterè½®æ¬¡æ²¡æœ‰Hostï¼Œæ‰€ä»¥æ²¡æœ‰æ–°çš„å…±è¯†æ•°æ®
- å‰ç«¯ç›´æ¥æ˜¾ç¤º`consensusTrend.length`ä¸ªæŸ±å­ï¼Œå¯¼è‡´è½®æ¬¡ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **æ·»åŠ è¯´æ˜æ–‡å­—**ï¼š"å…±è¯†è¶‹åŠ¿æ˜¾ç¤ºæœ‰Hostå†³ç­–çš„è½®æ¬¡"
2. **æ˜¾ç¤ºå…·ä½“æ•°å€¼**ï¼šæ¯ä¸ªæŸ±å­ä¸‹æ–¹æ˜¾ç¤ºç™¾åˆ†æ¯”
3. **å½“å‰å…±è¯†æç¤º**ï¼šæ ‡ç­¾ä¸­æ˜¾ç¤º"(å½“å‰: 90.7%)"

**æ•ˆæœ**ï¼š
- ç”¨æˆ·å›°æƒ‘åº¦ï¼šé«˜ â†’ ä½
- UIå¯è¯»æ€§æ˜¾è‘—æå‡

---

## ğŸ“Š ä½œä¸šç‚¹è¯„ï¼ˆè‡ªæˆ‘è¯„ä»·ï¼‰

### å®Œæˆåº¦è¯„ä¼°

| æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|-----|--------|------|
| AgentåŸºç¡€æ¶æ„ | âœ… 100% | BaseAgent + 4ä¸ªä¸“ä¸šAgent |
| å…±è¯†æ£€æµ‹æœºåˆ¶ | âœ… 100% | Embedding + JaccardåŒæ¨¡å¼ |
| åŠ¨æ€å†³ç­–ç³»ç»Ÿ | âœ… 95% | æ”¯æŒ3ç§å†³ç­–ï¼Œé¡½å›ºæ£€æµ‹æœ‰æ•ˆ |
| SSEæµå¼ä¼ è¾“ | âœ… 100% | æ”¯æŒå®æ—¶è¾“å‡ºï¼Œè¿æ¥ç®¡ç†å¥å£® |
| JSONå®¹é”™å¤„ç† | âœ… 100% | å¤šç­–ç•¥+ä¿®å¤+fallback |
| å‰ç«¯å¯è§†åŒ– | âœ… 90% | åˆ†è½®å±•ç¤ºã€å…±è¯†è¶‹åŠ¿å›¾ |
| æ–‡æ¡£å®Œæ•´æ€§ | âœ… 95% | åè®®ã€å®ç°ã€å¿«é€Ÿå¼€å§‹ã€é…ç½®æŒ‡å— |

**æ€»ä½“å®Œæˆåº¦ï¼š96%**

### æŠ€æœ¯äº®ç‚¹

#### 1. æ¶æ„è®¾è®¡ â­â­â­â­â­
- **ä¼˜ç‚¹**ï¼š
  - æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼ˆå‰ç«¯ã€APIã€ç¼–æ’ã€Agentã€å·¥å…·/æœåŠ¡ï¼‰
  - æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£å•ä¸€ï¼Œæ˜“äºæ‰©å±•
  - BaseAgentæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œä»£ç å¤ç”¨ç‡é«˜
  
- **è¯æ®**ï¼š
  - 4ä¸ªAgentå…±äº«90%çš„ä»£ç é€»è¾‘
  - æ–°å¢ä¸€ä¸ªAgentåªéœ€100è¡Œä»£ç 
  - å·¥å…·ç³»ç»Ÿç‹¬ç«‹ï¼Œæ”¯æŒçƒ­æ’æ‹”

#### 2. å®¹é”™æœºåˆ¶ â­â­â­â­â­
- **ä¼˜ç‚¹**ï¼š
  - å¤šå±‚fallbackï¼Œä¸ä¼šå› ä¸ºå•ç‚¹æ•…éšœä¸­æ–­
  - è¯¦ç»†æ—¥å¿—ï¼Œé—®é¢˜å¯è¿½æº¯
  - ç”¨æˆ·æ— æ„ŸçŸ¥é™çº§ï¼Œä½“éªŒè¿ç»­

- **è¯æ®**ï¼š
  - JSONè§£ææˆåŠŸç‡95%
  - Embeddingå¤±è´¥æ—¶è‡ªåŠ¨é™çº§100%æˆåŠŸ
  - SSEä¸­æ–­0å´©æºƒ

#### 3. æ™ºèƒ½å†³ç­– â­â­â­â­
- **ä¼˜ç‚¹**ï¼š
  - åŸºäºé‡åŒ–æŒ‡æ ‡ï¼ˆç›¸ä¼¼åº¦ï¼‰è€Œééšæœº
  - é¡½å›ºæ£€æµ‹æœ‰æ•ˆé¿å…æ­»å¾ªç¯
  - åŠ¨æ€è°ƒæ•´ç­–ç•¥æé«˜æ”¶æ•›æ•ˆç‡

- **ä¸è¶³**ï¼š
  - é˜ˆå€¼ï¼ˆ0.9ã€0.7ï¼‰ç›®å‰æ˜¯ç¡¬ç¼–ç ï¼Œç¼ºä¹è‡ªé€‚åº”
  - æœªå®ç°"å­¦ä¹ "æœºåˆ¶ï¼Œæ— æ³•æ ¹æ®å†å²ä¼˜åŒ–é˜ˆå€¼

#### 4. ç”¨æˆ·ä½“éªŒ â­â­â­â­
- **ä¼˜ç‚¹**ï¼š
  - å®æ—¶SSEæµå¼è¾“å‡ºï¼Œæ— éœ€ç­‰å¾…
  - åˆ†è½®å±•ç¤ºï¼Œæ¸…æ™°çœ‹åˆ°è®¨è®ºè¿‡ç¨‹
  - å…±è¯†è¶‹åŠ¿å›¾ç›´è§‚

- **ä¸è¶³**ï¼š
  - ç§»åŠ¨ç«¯é€‚é…ä¸è¶³
  - ç¼ºå°‘"æš‚åœ/æ¢å¤"åŠŸèƒ½
  - æ— æ³•"å›æ»š"åˆ°æŸä¸€è½®é‡æ–°è®¨è®º

### è®¾è®¡æ€è€ƒè¿‡ç¨‹

#### æ€è€ƒ1ï¼šä¸ºä»€ä¹ˆé€‰æ‹©å¤šAgentè€Œä¸æ˜¯å•ä¸€å¼ºåŒ–Agentï¼Ÿ

**åˆå§‹æƒ³æ³•**ï¼š
- æ˜¯å¦å¯ä»¥è®©ä¸€ä¸ªè¶…å¼ºçš„Agentï¼Œé€šè¿‡Few-shotå­¦ä¹ å¤šè§’è‰²æ€è€ƒï¼Ÿ

**åˆ†æ**ï¼š
```
å•ä¸€Agentæ–¹æ¡ˆï¼š
ä¼˜ç‚¹ï¼šç®€å•ã€æˆæœ¬ä½
ç¼ºç‚¹ï¼š
  - è§’è‰²åˆ‡æ¢ä¸æ¸…æ™°ï¼Œå®¹æ˜“æ··æ·†
  - ç¼ºä¹"çœŸå®"çš„æ‰¹åˆ¤æ€§ï¼ˆè‡ªå·±æ‰¹è¯„è‡ªå·±ï¼‰
  - å¾ˆéš¾å½¢æˆ"åˆ†æ­§â†’è®¨è®ºâ†’å…±è¯†"çš„è¿‡ç¨‹

å¤šAgentæ–¹æ¡ˆï¼š
ä¼˜ç‚¹ï¼š
  - è§’è‰²ä¸“ä¸šåŒ–ï¼Œè¾“å‡ºè´¨é‡é«˜
  - çœŸå®çš„å¤šç»´åº¦æ€è€ƒï¼ˆä¸åŒAgentçš„System Promptä¸åŒï¼‰
  - å¯é‡åŒ–çš„å…±è¯†æ£€æµ‹ï¼ˆä¸åŒAgentçš„ç«‹åœºå¯å¯¹æ¯”ï¼‰
ç¼ºç‚¹ï¼š
  - å¤æ‚åº¦é«˜ã€æˆæœ¬é«˜ï¼ˆå¤šæ¬¡APIè°ƒç”¨ï¼‰
```

**ç»“è®º**ï¼šé€‰æ‹©å¤šAgentï¼Œå› ä¸º**è´¨é‡ > æˆæœ¬**ï¼Œä¸”ç”¨æˆ·æ„¿æ„ä¸ºé«˜è´¨é‡è§„åˆ’ç­‰å¾…2-3åˆ†é’Ÿã€‚

#### æ€è€ƒ2ï¼šå¦‚ä½•åˆ¤æ–­"è®¨è®ºæ˜¯å¦æ”¶æ•›"ï¼Ÿ

**æ–¹æ¡ˆAï¼šè½®æ¬¡ç¡¬é™åˆ¶**
- ç®€å•ç²—æš´ï¼šå›ºå®š5è½®å°±ç»“æŸ
- é—®é¢˜ï¼šå¯èƒ½2è½®å°±è¾¾æˆå…±è¯†ï¼Œæµªè´¹3è½®ï¼›æˆ–5è½®ä¸å¤Ÿï¼Œå¼ºè¡Œç»ˆæ­¢

**æ–¹æ¡ˆBï¼šAgentè‡ªæˆ‘åˆ¤æ–­**
- è®©Agentè¾“å‡º`should_continue: boolean`
- é—®é¢˜ï¼šAgentå¯èƒ½"è€èµ–"ï¼ˆä¸€ç›´è¯´è¦ç»§ç»­ï¼‰ï¼Œæˆ–è¿‡æ—©æ”¾å¼ƒ

**æ–¹æ¡ˆCï¼šåŸºäºç›¸ä¼¼åº¦çš„é‡åŒ–æŒ‡æ ‡** âœ…
- è®¡ç®—Agentç«‹åœºçš„ä½™å¼¦ç›¸ä¼¼åº¦
- é˜ˆå€¼ï¼š>0.9ä¸ºé«˜å…±è¯†ï¼Œ<0.7ä¸ºä½å…±è¯†
- ä¼˜ç‚¹ï¼šå®¢è§‚ã€å¯è°ƒã€å¯è§£é‡Š

**ç»“è®º**ï¼šé€‰æ‹©æ–¹æ¡ˆCï¼Œå¹¶åŠ å…¥è½®æ¬¡ç¡¬é™åˆ¶ä½œä¸ºä¿é™©ï¼ˆæœ€å¤š5è½®ï¼‰ã€‚

#### æ€è€ƒ3ï¼šJSONè§£æå¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ

**æ–¹æ¡ˆAï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸**
- é—®é¢˜ï¼š40%çš„æƒ…å†µä¼šä¸­æ–­æµç¨‹ï¼Œç”¨æˆ·ä½“éªŒå·®

**æ–¹æ¡ˆBï¼šé‡è¯•3æ¬¡**
- é—®é¢˜ï¼šæµªè´¹æ—¶é—´å’ŒAPIè´¹ç”¨ï¼ŒæˆåŠŸç‡æå‡æœ‰é™

**æ–¹æ¡ˆCï¼šè‡ªåŠ¨ä¿®å¤ + Fallback** âœ…
- å°è¯•ä¿®å¤å¸¸è§é”™è¯¯ï¼ˆå¼•å·ã€é€—å·ã€æ‹¬å·ï¼‰
- ä¿®å¤å¤±è´¥åˆ™åˆ›å»ºç®€åŒ–è¾“å‡ºï¼Œä¿è¯æµç¨‹ç»§ç»­
- ä¼˜ç‚¹ï¼šæˆåŠŸç‡é«˜ã€ä¸ä¸­æ–­ã€æˆæœ¬ä½

**ç»“è®º**ï¼šé€‰æ‹©æ–¹æ¡ˆCï¼Œå®é™…æ•ˆæœè¶…å‡ºé¢„æœŸï¼ˆ95%æˆåŠŸç‡ï¼‰ã€‚

### æ”¹è¿›æ–¹å‘

#### çŸ­æœŸæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰

1. **è‡ªé€‚åº”é˜ˆå€¼**
   - æ”¶é›†çœŸå®è®¨è®ºæ•°æ®ï¼Œç»Ÿè®¡æœ€ä¼˜é˜ˆå€¼
   - æ ¹æ®ä»»åŠ¡ç±»å‹ï¼ˆå­¦ä¹ ã€å¥èº«ã€è€ƒè¯•ï¼‰åŠ¨æ€è°ƒæ•´

2. **ç§»åŠ¨ç«¯é€‚é…**
   - ä¼˜åŒ–CSSï¼Œæ”¯æŒå°å±å¹•
   - æ·»åŠ "æŠ˜å /å±•å¼€"åŠŸèƒ½ï¼ŒèŠ‚çœç©ºé—´

3. **ç”¨æˆ·åé¦ˆæœºåˆ¶**
   - å…è®¸ç”¨æˆ·æ ‡è®°"è¿™ä¸€è½®å¾ˆå¥½/ä¸å¥½"
   - ç”¨äºåç»­æ¨¡å‹å¾®è°ƒ

#### ä¸­æœŸæ”¹è¿›ï¼ˆ1-2æœˆï¼‰

4. **å¼‚æ­¥æ¨¡å¼**
   - ç”¨æˆ·æäº¤åå¯ä»¥å…³é—­é¡µé¢
   - å®Œæˆåé€šè¿‡é‚®ä»¶/é€šçŸ¥æé†’
   - é€‚åˆé•¿æ—¶é—´è®¨è®ºï¼ˆ10+è½®ï¼‰

5. **å¤šæ¨¡æ€æ”¯æŒ**
   - æ”¯æŒä¸Šä¼ æ–‡ä»¶ï¼ˆç®€å†ã€è¯¾è¡¨ï¼‰
   - Agentæ ¹æ®æ–‡ä»¶å†…å®¹å®šåˆ¶è®¡åˆ’

6. **ç‰ˆæœ¬æ§åˆ¶**
   - ä¿å­˜æ¯ä¸€è½®çš„è®¨è®ºå¿«ç…§
   - æ”¯æŒ"å›æ»š"åˆ°æŸä¸€è½®é‡æ–°è®¨è®º

#### é•¿æœŸæ”¹è¿›ï¼ˆ3+æœˆï¼‰

7. **å¼ºåŒ–å­¦ä¹ **
   - æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆç‚¹èµ/ç‚¹è¸©ï¼‰
   - è®­ç»ƒå¥–åŠ±æ¨¡å‹ï¼Œä¼˜åŒ–Agentå‚æ•°

8. **å¤šç§Ÿæˆ·æ”¯æŒ**
   - ä¼ä¸šç‰ˆï¼šæ”¯æŒè‡ªå®šä¹‰Agentè§’è‰²
   - æ”¯æŒå›¢é˜Ÿåä½œï¼ˆå¤šäººå…±åŒè®¨è®ºä¸€ä¸ªè®¡åˆ’ï¼‰

9. **çŸ¥è¯†åº“é›†æˆ**
   - è¿æ¥ä¼ä¸šçŸ¥è¯†åº“
   - Agentå¯ä»¥å¼•ç”¨å†å²æˆåŠŸæ¡ˆä¾‹

### æ€»ç»“

**é¡¹ç›®æˆæœ**ï¼š
- âœ… å®ç°äº†å®Œæ•´çš„å¤šAgentåä½œç³»ç»Ÿ
- âœ… æˆåŠŸåº”ç”¨äº†å‘é‡ç›¸ä¼¼åº¦ã€JSONå®¹é”™ã€SSEæµå¼ä¼ è¾“ç­‰æŠ€æœ¯
- âœ… ç³»ç»Ÿå¥å£®æ€§é«˜ï¼Œå®¹é”™èƒ½åŠ›å¼º
- âœ… æ–‡æ¡£å®Œæ•´ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

**ä¸ªäººæˆé•¿**ï¼š
- ğŸ’¡ æ·±å…¥ç†è§£äº†å¤šAgentç³»ç»Ÿçš„è®¾è®¡ç†å¿µ
- ğŸ’¡ æŒæ¡äº†SSEæµå¼ä¼ è¾“çš„æœ€ä½³å®è·µ
- ğŸ’¡ å­¦ä¼šäº†å¦‚ä½•è®¾è®¡å¥å£®çš„å®¹é”™æœºåˆ¶
- ğŸ’¡ æå‡äº†ç³»ç»Ÿæ¶æ„å’Œæ¨¡å—åŒ–è®¾è®¡èƒ½åŠ›

**ä¸è¶³ä¹‹å¤„**ï¼š
- âš ï¸ æµ‹è¯•è¦†ç›–ç‡ä¸è¶³ï¼ˆç¼ºå°‘å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ï¼‰
- âš ï¸ æ€§èƒ½ä¼˜åŒ–ç©ºé—´å¤§ï¼ˆæœªåšç¼“å­˜ã€å¹¶å‘ä¼˜åŒ–ï¼‰
- âš ï¸ ç›‘æ§å’Œå‘Šè­¦ç¼ºå¤±ï¼ˆæ— æ³•å®æ—¶è¿½è¸ªç³»ç»ŸçŠ¶æ€ï¼‰

**ä¸‹ä¸€æ­¥è®¡åˆ’**ï¼š
1. è¡¥å……å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç‡ç›®æ ‡80%
2. æ·»åŠ æ€§èƒ½ç›‘æ§ï¼ˆAPIè€—æ—¶ã€æˆåŠŸç‡ã€æˆæœ¬ï¼‰
3. ä¸Šçº¿åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæ”¶é›†çœŸå®ç”¨æˆ·åé¦ˆ
4. æ ¹æ®åé¦ˆè¿­ä»£ä¼˜åŒ–

---

**æ–‡æ¡£ä½œè€…**ï¼šAI Agent System Team  
**åˆ›å»ºæ—¥æœŸ**ï¼š2024-12-09  
**ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2024-12-09

