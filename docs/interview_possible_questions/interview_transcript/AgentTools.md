## Function Calling / å·¥å…·ç³»ç»Ÿï¼ˆé¢è¯•æ‰«è¯»ç‰ˆï¼‰

> ç›®æ ‡ï¼šå…ˆæŠŠâ€œç³»ç»Ÿé•¿ä»€ä¹ˆæ ·â€ä¸€å¥è¯è®²æ¸…ï¼Œå†ç”¨ 60â€“90 ç§’è®²é—­çŽ¯ï¼Œè¿½é—®æ—¶èƒ½è½åˆ°æ–‡ä»¶ã€‚

---

## 1) ä¸€å¥è¯å›žç­”ï¼šä½ æ€Žä¹ˆç”¨ Function Calling æž„å»ºå·¥å…·ç³»ç»Ÿï¼Ÿ

æˆ‘æŠŠâ€œå·¥å…·â€æŠ½è±¡æˆå¯æ’æ‹”æ’ä»¶ï¼ˆTool Pluginï¼‰ï¼Œé€šè¿‡ç»Ÿä¸€ schema ç»™æ¨¡åž‹åš Function Callingï¼Œé€šè¿‡ç»Ÿä¸€ executor åšç¼“å­˜/ç†”æ–­/é™æµ/æ ¡éªŒ/æŒ‡æ ‡ï¼›å¤æ‚åœºæ™¯å†ç”¨ orchestrator åšå¤šæ­¥ç¼–æŽ’ï¼ˆç±»ä¼¼ DAG/æ‹“æ‰‘æŽ’åºï¼‰ã€‚

---

## 2) æ€»ä½“é“¾è·¯ï¼ˆä»Žç”¨æˆ·è¯·æ±‚åˆ°è¿”å›žç»“æžœï¼‰

ç”¨æˆ·è¯·æ±‚  
â†“  
å·¥å…·æ³¨å†Œä¸­å¿ƒï¼ˆTool Registryï¼‰  
â†“  
å·¥å…·æ‰§è¡Œå™¨ï¼ˆTool Executorï¼‰  
â”œâ”€ ç¼“å­˜ç®¡ç†å™¨ï¼ˆCache Managerï¼‰â†’ å‘½ä¸­åˆ™ç«‹å³è¿”å›ž  
â”œâ”€ ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰â†’ ç†”æ–­åˆ™æ‹’ç»è¯·æ±‚  
â”œâ”€ é™æµå™¨ï¼ˆRate Limiterï¼‰â†’ è¶…é™åˆ™æ‹’ç»è¯·æ±‚  
â”œâ”€ å‚æ•°éªŒè¯ï¼ˆValidatorï¼‰â†’ éªŒè¯å¤±è´¥åˆ™è¿”å›žé”™è¯¯  
â””â”€ å·¥å…·æ‰§è¡Œï¼ˆTool Pluginï¼‰â†’ æ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘  
â†“  
å·¥å…·ç¼–æŽ’å™¨ï¼ˆTool Orchestratorï¼‰â†’ å¤šæ­¥éª¤å·¥å…·è°ƒç”¨  
â†“  
è¿”å›žç»“æžœ + æŒ‡æ ‡ç»Ÿè®¡

---

## 3) ç¨³å®šæ€§è®¾è®¡ï¼šä¸ºä»€ä¹ˆè¦â€œä¿æŠ¤é“¾ + é™çº§é“¾â€ï¼ˆHystrix æ€è·¯ï¼‰

### ä¸€å¥è¯ç­”æ¡ˆ

å·¥å…·è°ƒç”¨ä¼šæ‰“å¤–éƒ¨ APIã€å¤±è´¥çŽ‡ä¸å¯æŽ§ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒå½“æˆâ€œå¾®æœåŠ¡è°ƒç”¨â€æ¥æ²»ç†ï¼šå…ˆåšä¿æŠ¤é“¾ï¼ˆç¼“å­˜/ç†”æ–­/é™æµ/æ ¡éªŒï¼‰ï¼Œå†åšé™çº§é“¾ï¼ˆç¼“å­˜/å¤‡ç”¨/ç®€åŒ–/å…œåº•ï¼‰ï¼Œç¡®ä¿ä»»ä½•æ—¶å€™éƒ½æœ‰å¯è§£é‡Šè¾“å‡ºã€‚

### ä½ å¯ä»¥è¿™æ ·è¯´ï¼ˆæŠŠ 17â€“23 æ®µæ‹†æˆå¯æ‰«è¯»è¦ç‚¹ï¼‰

- **ç†”æ–­é™çº§**ï¼šä¸‰æ€ç†”æ–­å™¨è‡ªåŠ¨ä¿æŠ¤ï¼ˆClosed â†’ Open â†’ Half-Openï¼‰
- **é™çº§é“¾ï¼ˆæŒ‰ä¼˜å…ˆçº§å°è¯•ï¼‰**
  - ç¼“å­˜é™çº§ï¼ˆè¿”å›žæ—§æ•°æ®ï¼‰
  - å¤‡ç”¨æœåŠ¡åˆ‡æ¢ï¼ˆä¸»æœåŠ¡ â†’ å¤‡ç”¨æœåŠ¡ï¼‰
  - ç®€åŒ–è°ƒç”¨ï¼ˆç”¨æ›´å°‘èµ„æºé‡è¯•ï¼‰
  - é»˜è®¤å“åº”ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰
- **å¤šçº§é™çº§**ï¼šæ”¯æŒåŠŸèƒ½é™çº§ã€è¯»é™çº§ã€å†™é™çº§
- **å¿«é€Ÿå¤±è´¥**ï¼šé™çº§ç­–ç•¥æœ‰ç‹¬ç«‹è¶…æ—¶æŽ§åˆ¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…

---

## 4) ä¸ºä»€ä¹ˆ web æœç´¢æ’ä»¶é€‰ Tavilyï¼Ÿ

### ä¸€å¥è¯ç­”æ¡ˆ

å› ä¸º Tavily æ›´åƒâ€œç»™ LLM ç”¨çš„æœç´¢ APIâ€ï¼š**ç»“æžœæ›´ç»“æž„åŒ–ã€ç¨³å®šæ€§å’Œé…é¢æ›´å¯é¢„æœŸ**ï¼ŒæŽ¥å…¥åŽæ›´å®¹æ˜“åšç¼“å­˜/é™æµ/é™çº§é“¾ï¼Œç¬¦åˆæˆ‘ä»¬æ’ä»¶åŒ–å·¥å…·ç³»ç»Ÿçš„å·¥ç¨‹è¯‰æ±‚ã€‚

### é€‰æ‹©ç†ç”±ï¼ˆé¢è¯•å®˜å¸¸é—®â€œä½ ä¸ºä»€ä¹ˆä¸ç”¨è‡ªå·±çˆ¬/ä¸ç”¨åˆ«å®¶â€ï¼‰

- **ç»“æž„åŒ–ç»“æžœå‹å¥½**ï¼šè¿”å›žçš„æ•°æ®æ›´é€‚åˆç›´æŽ¥å–‚ç»™æ¨¡åž‹ï¼ˆæ ‡é¢˜/æ‘˜è¦/æ¥æº/é“¾æŽ¥ç­‰ï¼‰ï¼Œå‡å°‘ä½ è‡ªå·±åšç½‘é¡µæŠ“å–ã€æ­£æ–‡æŠ½å–ã€åŽ»å™ªä¸Žæ ¼å¼åŒ–çš„å·¥ä½œé‡ã€‚
- **ç¨³å®šæ€§ä¸Žæˆæœ¬å¯æŽ§**ï¼šå¯¹æ¯”â€œä¸´æ—¶çˆ¬è™«/ç½‘é¡µæŠ“å–â€ï¼ŒAPI åŒ–çš„æœç´¢æ›´ç¨³å®šï¼Œä¹Ÿæ›´å®¹æ˜“æŽ§åˆ¶è¶…æ—¶ã€é‡è¯•ä¸Žè´¹ç”¨ä¸Šé™ã€‚
- **æ›´å®¹æ˜“çº³å…¥æ²»ç†ä½“ç³»**ï¼šä½ å·²ç»æœ‰ rate limiter / circuit breaker / cache managerï¼ŒæŠŠ Tavily å½“æˆä¸€ä¸ªå¤–éƒ¨ä¾èµ–æŽ¥è¿›æ¥ï¼Œå¤©ç„¶å°±èƒ½å¥—ä¸Šâ€œä¿æŠ¤é“¾ + é™çº§é“¾â€ã€‚
- **åˆè§„ä¸Žå·¥ç¨‹é£Žé™©æ›´ä½Ž**ï¼šä¸éœ€è¦å¤„ç†åçˆ¬ã€éªŒè¯ç ã€ç«™ç‚¹ç­–ç•¥å˜åŒ–å¯¼è‡´çš„é¢‘ç¹å´©æºƒï¼ˆå¯¹å·¥å…·ç³»ç»Ÿæ¥è¯´è¿™ç±»ä¸ç¡®å®šæ€§æ˜¯å¤§æ•Œï¼‰ã€‚

### é¡¹ç›®è¯æ®ï¼ˆä»£ç è½ç‚¹ï¼‰

- Web æœç´¢æ’ä»¶ï¼š`api/tools/v2/plugins/search-web.plugin.ts`

---

## 5) æž¶æž„è½åœ°ï¼šæ’ä»¶åŒ– + æ³¨å†Œä¸­å¿ƒ + æ‰§è¡Œå™¨ + ç¼–æŽ’å™¨

æˆ‘ä»¬é‡‡ç”¨å¯æ’æ‹”æž¶æž„ï¼Œé€šè¿‡ `types.ts` å®šä¹‰ç»Ÿä¸€çš„ ToolPlugin æŽ¥å£ï¼Œæ¯ä¸ªå·¥å…·åŒ…å«ï¼š

- **metadata**ï¼šå…ƒæ•°æ®ï¼ˆç”¨äºŽç³»ç»Ÿå†…éƒ¨ç®¡ç†ï¼‰
- **schema**ï¼šFunction Calling æ ¼å¼ï¼ˆå‘é€ç»™ AI æ¨¡åž‹ï¼‰
- **execute**ï¼šæ‰§è¡Œé€»è¾‘

å·¥å…·é€šè¿‡ `tool-registry.ts` æ³¨å†Œä¸­å¿ƒä»¥ `metadata.name` ä¸º key å­˜å‚¨åœ¨ Map ä¸­ï¼Œæ”¯æŒæŒ‰ tags åˆ†ç±»ã€æŒ‰ enabled çŠ¶æ€ç­›é€‰ã€‚æ‰§è¡Œæ—¶ç”± `tool-executor.ts` ç»Ÿä¸€è°ƒåº¦ï¼Œé›†æˆï¼š

- `rate-limiter.ts`ï¼ˆæ»‘åŠ¨çª—å£é™æµï¼‰
- `cache-manager.ts`ï¼ˆç¼“å­˜ï¼‰
- `circuit-breaker.ts`ï¼ˆä¸‰æ€ç†”æ–­å™¨ï¼‰

å¤æ‚åœºæ™¯ç”± `tool-orchestrator.ts` é€šè¿‡æ‹“æ‰‘æŽ’åºå¤„ç†å·¥å…·é—´ä¾èµ–ï¼Œæ”¯æŒå¤±è´¥é‡è¯•å’Œå‚æ•°ä¼ é€’ã€‚

---

## 6) é¢è¯•è¯æœ¯ç‰ˆï¼ˆç›´æŽ¥ç…§ç€è®²ï¼Œ60â€“90 ç§’ï¼‰

é¢è¯•å®˜ï¼šä»‹ç»ä¸€ä¸‹ä½ çš„ AI Agent å·¥å…·ç³»ç»Ÿï¼Ÿ

â€œæˆ‘ä»¬çš„å·¥å…·ç³»ç»Ÿä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š**å·¥å…·çš„æ ‡å‡†åŒ–ç®¡ç†**ï¼Œä»¥åŠ**æ‰§è¡Œæ—¶çš„å¯é æ€§ä¿éšœ**ã€‚æž¶æž„ä¸Šæ˜¯æ’ä»¶åŒ–è®¾è®¡ï¼Œæ ¸å¿ƒæœ‰ 7 ä¸ªæ–‡ä»¶ï¼š
1. types.ts - å®šä¹‰ ToolPlugin æŽ¥å£ï¼Œæ¯ä¸ªå·¥å…·åŒ…å« metadataï¼ˆå†…éƒ¨ç®¡ç†ï¼‰å’Œ schemaï¼ˆç»™ AI çœ‹ï¼‰
2. tool-registry.ts - æ³¨å†Œä¸­å¿ƒï¼Œç”¨ Map å­˜å‚¨å·¥å…·ï¼Œæ”¯æŒæŒ‰ name æŸ¥è¯¢ã€æŒ‰ tags åˆ†ç±»ã€æŒ‰ enabled åŠ¨æ€å¯ç”¨
3. tool-executor.ts - æ‰§è¡Œå™¨ï¼Œæ•´åˆä¸‰å±‚ä¿æŠ¤æœºåˆ¶å¹¶è®°å½•æŒ‡æ ‡
4. rate-limiter.ts - æ»‘åŠ¨çª—å£ç®—æ³•å®žçŽ°å¹¶å‘å’Œé¢‘çŽ‡é™æµ
5. cache-manager.ts - æŒ‰å‚æ•°æˆ–ç”¨æˆ·ç»´åº¦ç¼“å­˜ï¼Œæ”¯æŒ TTL è¿‡æœŸ
6. circuit-breaker.ts - ç»å…¸ä¸‰æ€ç†”æ–­å™¨ï¼ˆclosed â†’ open â†’ half-openï¼‰ï¼Œé˜²æ­¢çº§è”æ•…éšœ
7. tool-orchestrator.ts - ç¼–æŽ’å™¨ï¼Œæ‹“æ‰‘æŽ’åºå¤„ç†å¤šæ­¥éª¤å·¥å…·è°ƒç”¨
æ‰§è¡Œæµç¨‹æ˜¯ï¼šç¼“å­˜æ£€æŸ¥ â†’ ç†”æ–­æ£€æŸ¥ â†’ é™æµ â†’ å‚æ•°éªŒè¯ â†’ æ‰§è¡Œ â†’ è®°å½•æŒ‡æ ‡ â†’ ç¼“å­˜ç»“æžœã€‚æŠ€æœ¯äº®ç‚¹ï¼š
- metadata çš„ enabled å­—æ®µæ”¯æŒåŠ¨æ€å¼€å…³
- tags æ”¯æŒåœºæ™¯åŒ–å·¥å…·åŠ è½½
- å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆonInit/onDestroyï¼‰
- å…¨é“¾è·¯æŒ‡æ ‡ç›‘æŽ§ï¼ˆæˆåŠŸçŽ‡ã€å»¶è¿Ÿã€ç¼“å­˜å‘½ä¸­çŽ‡ï¼‰
è¿™å¥—æž¶æž„è®©æ–°å·¥å…·æŽ¥å…¥æˆæœ¬å¾ˆä½Žï¼Œåªéœ€å®žçŽ°æŽ¥å£å³å¯ï¼Œæ ¸å¿ƒä»£ç æ— éœ€ä¿®æ”¹ï¼Œç¬¦åˆå¼€é—­åŽŸåˆ™ã€‚"

---

## 7) å…³é”®æ–‡ä»¶èŒè´£é€Ÿè®°

ï¼ˆå¦‚æžœä½ éœ€è¦ï¼Œè¿™å—å¯ä»¥åŽç»­è¡¥æˆâ€œ1 è¡Œ/æ–‡ä»¶â€çš„é€Ÿè®°è¡¨ï¼›çŽ°åœ¨å…ˆä¿ç•™å ä½ã€‚ï¼‰

---

## 8) å·¥å…·ç³»ç»Ÿæž¶æž„åˆ†æžæŠ¥å‘Šï¼ˆé—®é¢˜é©±åŠ¨è®¾è®¡ï¼‰

ðŸŽ¯ é—®é¢˜é©±åŠ¨è®¾è®¡
åŽŸå§‹é—®é¢˜ â†’ è®¾è®¡å†³ç­–

1. "å·¥å…·è°ƒç”¨ä¸ç¨³å®šï¼Œæ¨¡åž‹å¹»è§‰"
   â†’ é‡‡ç”¨ OpenAI Function Callingï¼ˆç»“æž„åŒ–ï¼‰

2. "é«˜å¹¶å‘æ‰“çˆ†å¤–éƒ¨ API"
   â†’ é™æµå™¨ + ç†”æ–­å™¨ï¼ˆNetflix Hystrix æ¨¡å¼ï¼‰

3. "é‡å¤è°ƒç”¨æµªè´¹èµ„æº"
   â†’ ç¼“å­˜ç®¡ç†å™¨ï¼ˆRedis + å†…å­˜åŒå±‚ï¼‰

4. "æœåŠ¡æ•…éšœå½±å“ç”¨æˆ·"
   â†’ é™çº§é“¾ï¼ˆHystrix Fallback Chainï¼‰

5. "å¤šæ­¥éª¤éœ€è¦äººå·¥å¹²é¢„"
   â†’ å·¥å…·ç¼–æŽ’å™¨ï¼ˆAirflow DAG æ€æƒ³ï¼‰

6. "æ·»åŠ å·¥å…·è¦æ”¹å¾ˆå¤šåœ°æ–¹"
   â†’ æ’ä»¶å¼æž¶æž„ï¼ˆVSCode Extensionï¼‰

7. "æ•…éšœæ— æ³•å®šä½"
   â†’ å®Œæ•´å¯è§‚æµ‹æ€§ï¼ˆOpenTelemetry ä¸‰æ”¯æŸ±ï¼‰
1. æ ¸å¿ƒå‚è€ƒæž¶æž„ï¼ˆä»Žæ–‡æ¡£å’Œä»£ç ä¸­å‘çŽ°ï¼‰

 æ’ä»¶å¼æž¶æž„ï¼ˆPlugin Architectureï¼‰
å‚è€ƒå¯¹è±¡ï¼š
- VSCode Extension System - æ‰©å±•æ’ä»¶ç³»ç»Ÿï¼šæ ¸å¿ƒç‰¹ç‚¹ï¼šè¿›ç¨‹éš”ç¦»ã€å£°æ˜Žå¼é…ç½®ã€ç»Ÿä¸€ APIã€‚VSCode çš„æ‰©å±•ç³»ç»Ÿé€šè¿‡ package.json å£°æ˜Žæ’ä»¶çš„å…ƒæ•°æ®ã€æ¿€æ´»æ—¶æœºå’Œè´¡çŒ®ç‚¹ï¼ˆcommandsã€è¯­è¨€æ”¯æŒã€ä¸»é¢˜ç­‰ï¼‰ï¼Œæ’ä»¶è¿è¡Œåœ¨ç‹¬ç«‹çš„ Extension Host è¿›ç¨‹ä¸­ï¼Œé€šè¿‡æ ‡å‡† API ä¸Žä¸»è¿›ç¨‹é€šä¿¡ã€‚è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†ä¸»è¿›ç¨‹çš„ç¨³å®šæ€§ï¼ˆæ’ä»¶å´©æºƒä¸å½±å“ç¼–è¾‘å™¨ï¼‰ï¼Œåˆæä¾›äº†ä¸°å¯Œçš„æ‰©å±•èƒ½åŠ›ï¼Œæ˜¯éš”ç¦»å¼æ’ä»¶æž¶æž„çš„å…¸èŒƒã€‚
- JSæ¡†æž¶ï¼šreactï¼šåœ¨æž„å»ºç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µæš´éœ²é’©å­ï¼ˆhooksï¼‰ï¼Œæ’ä»¶é€šè¿‡è®¢é˜…è¿™äº›é’©å­æ¥ä»‹å…¥æž„å»ºæµç¨‹ï¼Œå¯ä»¥ä¿®æ”¹èµ„æºã€ç”Ÿæˆæ–‡ä»¶ã€ä¼˜åŒ–ä»£ç ç­‰ã€‚è¿™æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„æ’ä»¶ç³»ç»Ÿï¼Œæ‰€æœ‰æ’ä»¶å…±äº«åŒä¸€ä¸ªç¼–è¯‘ä¸Šä¸‹æ–‡ã€‚
- Eclipse OSGi -åŠ¨æ€æ¨¡å—ç³»ç»Ÿï¼Œæ¯ä¸ªæ’ä»¶ï¼ˆBundleï¼‰æœ‰æ˜Žç¡®çš„ä¾èµ–å£°æ˜Žå’Œç‰ˆæœ¬ç®¡ç†ï¼Œæ”¯æŒæ’ä»¶çš„çƒ­æ’æ‹”ï¼ˆè¿è¡Œæ—¶å®‰è£…/å¸è½½/æ›´æ–°ï¼‰å’ŒæœåŠ¡æ³¨å†Œ/å‘çŽ°æœºåˆ¶ã€‚
ä¼˜åŠ¿ï¼š
- âœ… é›¶ä¾µå…¥æ‰©å±•ï¼šæ·»åŠ æ–°å·¥å…·åªéœ€åˆ›å»ºæ’ä»¶æ–‡ä»¶
- âœ… å¼€é—­åŽŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
- âœ… è§£è€¦åˆï¼šå·¥å…·ä¸çŸ¥é“é™æµã€ç¼“å­˜å¦‚ä½•å®žçŽ°
// å€Ÿé‰´ VSCodeï¼šå£°æ˜Žå¼å…ƒæ•°æ®ï¼Œä¸ç»™æ¨¡åž‹ï¼Œä¾›ç³»ç»ŸéªŒè¯å‚æ•°ï¼Œåå­—æ˜¯å¦æ­£ç¡®ï¼Œå·¥å…·æ˜¯å¦å¯ç”¨
metadata: {
  name: 'search_web',
  version: '1.0.0',
  enabled: true,
  tags: ['search', 'external-api']
}

// å€Ÿé‰´ Webpackï¼šç”Ÿå‘½å‘¨æœŸé’©å­
onInit: () => {
  console.log('æ’ä»¶åˆå§‹åŒ–');
},
onDestroy: () => {
  console.log('æ’ä»¶é”€æ¯');
}

// å€Ÿé‰´ OSGiï¼šæœåŠ¡æ³¨å†Œå’Œå‘çŽ°
toolRegistry.register(plugin);           // æ³¨å†Œ
toolRegistry.get('search_web');          // å‘çŽ°
toolRegistry.getByTags(['search']);      // æŒ‰æœåŠ¡ç±»åž‹æŸ¥æ‰¾
ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼š
// æ¯ä¸ªå·¥å…·éƒ½æ˜¯ç‹¬ç«‹çš„æ’ä»¶ï¼Œéµå¾ªç»Ÿä¸€æŽ¥å£
interface ToolPlugin {
  metadata: ToolMetadata;    // å…ƒæ•°æ®ç®¡ç†
  schema: FunctionSchema;     // OpenAI Function Calling
  execute: () => Promise;     // æ‰§è¡Œé€»è¾‘
  rateLimit?: RateLimitConfig;
  cache?: CacheConfig;
  circuitBreaker?: CircuitBreakerConfig;

ä¸šç•Œæˆç†Ÿçš„é™çº§æ–¹æ¡ˆï¼šæˆ‘ä»¬é¡¹ç›®åœ¨webæœç´¢å·¥å…·ä¸­åˆæ­¥ä½¿ç”¨
1. Netflix Hystrix æ¨¡å¼ï¼ˆæœ€åŽé‡‡ç”¨ï¼‰
æ ¸å¿ƒç­–ç•¥ï¼š
- Fallback Chainï¼ˆé™çº§é“¾ï¼‰ï¼šä¸»æœåŠ¡ â†’ å¤‡ç”¨æœåŠ¡ â†’ ç¼“å­˜ â†’ é»˜è®¤å€¼
- Command Patternï¼šæ¯ä¸ªæœåŠ¡è°ƒç”¨å°è£…ä¸º Commandï¼Œå†…ç½®é™çº§é€»è¾‘
- è¶…æ—¶æŽ§åˆ¶ + ç†”æ–­ + é™çº§ï¼šä¸‰ä½ä¸€ä½“
ä»£ç æ¨¡å¼ï¼š
@HystrixCommand(fallbackMethod = "fallbackMethod")
public String normalMethod() {
    // ä¸»é€»è¾‘
}
public String fallbackMethod() {
    // é™çº§é€»è¾‘ï¼šè¿”å›žç¼“å­˜æˆ–é»˜è®¤å€¼
}
2. å¤šçº§é™çº§ç­–ç•¥ï¼ˆäº¬ä¸œå®žè·µï¼‰
äº¬ä¸œä¸ºç»“ç®—é¡µè®¾è®¡äº† 62 ä¸ªæœåŠ¡æŽ¥å£çš„é™çº§é¢„æ¡ˆï¼Œåˆ†ä¸ºï¼š
- Level 0ï¼šæ­£å¸¸æœåŠ¡ï¼ˆå…¨åŠŸèƒ½ï¼‰
- Level 1ï¼šåŠŸèƒ½é™çº§ï¼ˆå…³é—­æŽ¨èã€è¯„è®ºç­‰éžæ ¸å¿ƒåŠŸèƒ½ï¼‰
- Level 2ï¼šè¯»é™çº§ï¼ˆåªè¿”å›žç¼“å­˜æ•°æ®ï¼‰
- Level 3ï¼šå†™é™çº§ï¼ˆå¼‚æ­¥å¤„ç†æˆ–é™æµï¼‰
- Level 4ï¼šæ ¸å¿ƒä¿æŠ¤ï¼ˆåªä¿ç•™ä¸‹å•å’Œæ”¯ä»˜ï¼‰
3. æœåŠ¡é™çº§çš„äº”å¤§ç­–ç•¥
æš‚æ—¶æ— æ³•åœ¨é£žä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹
æˆ‘æ¥åˆ†æžä¸€ä¸‹è¿™ä¸ªå·¥å…·ç³»ç»Ÿçš„æž¶æž„è®¾è®¡ï¼Œå¹¶æœç´¢å®ƒå‚è€ƒçš„æˆç†Ÿæž¶æž„æ¨¡å¼ã€‚

### ç†”æ–­å™¨æ¨¡å¼ï¼ˆCircuit Breaker Patternï¼‰

å‚è€ƒå¯¹è±¡ï¼š
- Netflix Hystrix - å¾®æœåŠ¡ç†”æ–­å™¨æ ‡å‡†å®žçŽ°
- Resilience4j - è½»é‡çº§å®¹é”™åº“
- Martin Fowler çš„ Circuit Breaker Pattern
  
ä¸ºä»€ä¹ˆç”¨ä¸‰æ€æ¨¡åž‹ï¼š
Closedï¼ˆæ­£å¸¸ï¼‰ â†’ å·¥ä½œæ­£å¸¸
   â†“ è¿žç»­å¤±è´¥ 5 æ¬¡
Openï¼ˆç†”æ–­ï¼‰ â†’ æ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œå¿«é€Ÿå¤±è´¥
   â†“ ç­‰å¾… 60 ç§’
Half-Openï¼ˆåŠå¼€ï¼‰ â†’ å…è®¸å°‘é‡æµ‹è¯•è¯·æ±‚
   â†“ æˆåŠŸ â†™    â†˜ å¤±è´¥
Closedï¼ˆæ¢å¤ï¼‰  Openï¼ˆå†æ¬¡ç†”æ–­ï¼‰

è®¾è®¡ä¾æ®ï¼ˆæ¥è‡ª Hystrix ç»éªŒï¼‰ï¼š
- 5 æ¬¡å¤±è´¥é˜ˆå€¼ï¼šæ—¢èƒ½å¿«é€Ÿå“åº”ï¼Œåˆé¿å…è¯¯åˆ¤
- 60 ç§’é‡ç½®ï¼šç»™æœåŠ¡è¶³å¤Ÿæ¢å¤æ—¶é—´
- åŠå¼€æµ‹è¯•ï¼šæ¸è¿›å¼æ¢å¤ï¼Œä¸ä¼šä¸€æ¬¡æ”¾å¼€æ‰€æœ‰æµé‡
  
 é™æµå™¨ï¼ˆRate Limiterï¼‰

å‚è€ƒå¯¹è±¡ï¼š
- Nginx Rate Limiting - Web æœåŠ¡å™¨é™æµ
- API Gateway - äº‘æœåŠ¡ API ç½‘å…³
- Token Bucket / Leaky Bucket ç®—æ³•
  
ä¸ºä»€ä¹ˆç”¨æ»‘åŠ¨çª—å£ï¼š
// æ»‘åŠ¨çª—å£ç®—æ³•ï¼ˆæ¯”å›ºå®šçª—å£æ›´ç²¾ç¡®ï¼‰
const now = Date.now();
const oneMinuteAgo = now - 60000;
const recentCalls = history.filter(t => t > oneMinuteAgo);

// ä¼˜åŠ¿ï¼š
// âŒ å›ºå®šçª—å£ï¼š00:59 è¯·æ±‚ 100 æ¬¡ï¼Œ01:01 åˆè¯·æ±‚ 100 æ¬¡ï¼ˆçž¬æ—¶ 200 æ¬¡ï¼‰
// âœ… æ»‘åŠ¨çª—å£ï¼šä»»æ„ 60 ç§’å†…æœ€å¤š 100 æ¬¡

ä¸¤å±‚é™æµï¼š
1. å¹¶å‘é™æµï¼šé˜²æ­¢èµ„æºè€—å°½ï¼ˆåŒæ—¶æ‰§è¡Œä¸è¶…è¿‡ 50 ä¸ªï¼‰
2. é¢‘çŽ‡é™æµï¼šé˜²æ­¢ API é™é¢ç”¨å®Œï¼ˆæ¯åˆ†é’Ÿä¸è¶…è¿‡ 100 æ¬¡ï¼‰
  
### ç¼“å­˜ç­–ç•¥ï¼ˆCache Strategyï¼‰

å‚è€ƒå¯¹è±¡ï¼š
- Redis Cache - åˆ†å¸ƒå¼ç¼“å­˜
- HTTP Cache Control - Web ç¼“å­˜æ ‡å‡†
- LRU Cache - æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•
  
å¤šå±‚ç¼“å­˜è®¾è®¡ï¼š
ä¼˜å…ˆçº§ 1: Redis ç¼“å­˜ï¼ˆåˆ†å¸ƒå¼ï¼ŒæŒä¹…åŒ–ï¼‰
   â†“ ä¸å¯ç”¨
ä¼˜å…ˆçº§ 2: å†…å­˜ç¼“å­˜ï¼ˆæœ¬åœ°ï¼Œå¿«é€Ÿï¼‰
   â†“ éƒ½ä¸å¯ç”¨
ç›´æŽ¥æ‰§è¡Œå·¥å…·

ä¸ºä»€ä¹ˆæ”¯æŒè¿‡æœŸç¼“å­˜ï¼š
// é™çº§ç­–ç•¥ï¼šå®æ„¿è¿”å›žè¿‡æœŸæ•°æ®ï¼Œä¹Ÿæ¯”å®Œå…¨ä¸å¯ç”¨å¥½
stale-cache: è¿”å›žè¿‡æœŸç¼“å­˜ï¼ˆæ ‡è®° degraded: trueï¼‰
// å‚è€ƒï¼šHTTP Cache-Control: stale-while-revalidate


---


### å·¥å…·ç¼–æŽ’ï¼ˆTool Orchestrationï¼‰

å‚è€ƒå¯¹è±¡ï¼š
- AWS Step Functions - çŠ¶æ€æœºç¼–æŽ’
- LangGraph - AI Agent å·¥ä½œæµ
  
ä¸ºä»€ä¹ˆç”¨æ‹“æ‰‘æŽ’åºï¼š
// é—®é¢˜ï¼šå¦‚ä½•ä¿è¯æ­¥éª¤æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œï¼Ÿ
// æ–¹æ¡ˆï¼šæ‹“æ‰‘æŽ’åºï¼ˆTopological Sortï¼‰

æ­¥éª¤ä¾èµ–ï¼š
step1: list_plans (æ— ä¾èµ–)
step2: get_plan (ä¾èµ– step1)
step3: update_plan (ä¾èµ– step2)

ç®—æ³•ï¼šDFS æ·±åº¦ä¼˜å…ˆéåŽ†
æ—¶é—´å¤æ‚åº¦ï¼šO(V + E)

å˜é‡å¼•ç”¨æœºåˆ¶ï¼š
// å‚è€ƒï¼šæ¨¡æ¿å¼•æ“Žï¼ˆHandlebars, Jinja2ï¼‰
params: {
  plan_id: "${step1.data.planId}"  // ä»Žä¸Šä¸€æ­¥ç»“æžœå–å€¼
}

// å®žçŽ°ï¼šæ­£åˆ™æ›¿æ¢ + è·¯å¾„éåŽ†
value.replace(/\$\{([^}]+)\}/g, (match, path) => {
  const [stepId, ...keys] = path.split('.');
  return getValueByPath(stepResults[stepId], keys);
});


---



