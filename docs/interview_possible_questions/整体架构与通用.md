# 整体架构 / 通用：面试追问与标准回答（贴合本项目）

## 1) 你这个后端架构有点像 Spring Boot，为什么这么做？为什么不直接用 Java/Spring Boot？

- **一句话回答**：我用的是 Clean Architecture 的分层思想：Handler/路由像 Controller，Use Case 像 Service，Repository 像 DAO；用 Node/TS 是为了和前端同语言、BFF 一体化、开发迭代更快。
- **项目证据**
  - `api/handlers/README.md`：Handlers 是 Presentation Layer，只做协议/参数/流式输出，不做业务
  - `api/_clean/*`：Use Cases / Domain / Infrastructure 分层
  - `docs/01-Architecture-Refactoring/*`：渐进式迁移到 Clean Architecture 的全过程

## 2) 前端你怎么分“基础组件/业务组件”？按什么原则？

- **一句话回答**：基础组件只负责“可复用 UI 能力”，业务组件承载“领域状态与交互”，并尽量把复杂渲染/性能策略封装在业务组件内部，降低页面层复杂度。
- **项目证据**
  - `src/components/base/*`：基础组件与布局能力
  - `src/components/business/*`：聊天/消息/会话等领域组件（如 `MessageListRefactored`）

## 3) 为什么状态管理用 Zustand，不用 Redux / Context / useContext？

- **一句话回答**：Zustand 足够轻、API 简单、selector 订阅粒度细，适合“高频流式更新”的聊天场景；Redux 样板重，Context 容易引起大范围 re-render。
- **项目证据**
  - `package.json`：`zustand`
  - `docs/README.md`：前端技术栈写明 Zustand
- **面试官追问怎么接**
  - **为什么不 Context**：Context 更新会导致消费树大范围刷新，聊天流式更新频率高会更明显；Zustand 可以只让订阅了某个 slice 的组件刷新。

## 4) 测试怎么做？用例设计考虑哪些方面？

- **一句话回答**：我会按“单元（纯函数/Use Case）→ 集成（路由/DB/缓存）→ 端到端（流式/断网/重连/大文本）”分层设计，并覆盖最关键的 edge cases（超长文本、断网续传、并发排队、用户取消）。
- **项目证据（现有）**
  - `test/*`：包含 Redis 连接、队列、缓存、流式等测试脚本
  - `docs/03-Streaming/STREAMING_TEST_GUIDE.md`：流式测试场景清单

## 5) Docker 打包镜像发布，为什么不自己配 webpack？

- **一句话回答**：这个项目是 Modern.js 全栈一体化，构建链路由框架托管（现代构建体系），我只需要写好 Docker 多阶段构建即可；自己配 webpack 会增加大量非业务复杂度。
- **项目证据**
  - `Dockerfile`：Modern.js multi-stage build
  - `package.json`：`modern build/start/serve`
  - `modern.config.ts`：BFF 插件与 API 前缀约定

## 6) 做项目时遇到过哪些典型 bug？怎么排查解决的？

- **一句话回答**：我遇到过“客户端断开导致服务端 AbortError 崩溃”“虚拟列表滚动/高度抖动”“CORS/预检”等，排查方式是：复现→加诊断日志→最小化影响→补上保护/降级。
- **项目证据**
  - `docs/03-Streaming/CRITICAL_FIX_CONNECTION_ABORT.md`：断开连接的关键修复
  - `api/handlers/sseHandler.ts`：`safeWrite` 捕获 AbortError，不把正常断连当 fatal
  - `docs/06-Performance-Optimization/*`：滚动/CLS/内存泄漏的定位与优化

## 7) React “白屏”一般怎么排查？这个项目里你会怎么做？

- **一句话回答**：先看控制台报错栈和 Network，再看资源是否 404/CSP/CORS，再排查路由与渲染异常；必要时加 ErrorBoundary + 埋点，把线上白屏变成可观测问题。
- **可落地的排查清单**
  - **前端**：Console/Network/SourceMap，确认 chunk 资源与环境变量
  - **后端**：`/api/health`、日志、SSE 是否被代理缓冲
  - **构建**：Modern.js build 输出、静态资源路径与缓存策略


