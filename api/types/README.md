# Types ç›®å½• - Shared Type Definitionsï¼ˆå…±äº«ç±»å‹å®šä¹‰ï¼‰

## ğŸ“ æ¶æ„å®šä½

**Types** æ˜¯ Clean Architecture çš„ **Shared Kernelï¼ˆå…±äº«å†…æ ¸ï¼‰**ï¼ŒåŒ…å«è·¨å±‚å…±äº«çš„ç±»å‹å®šä¹‰ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Shared Type Definitions                   â”‚
â”‚                        (api/types/)                          â”‚
â”‚   ChatMessage, ChatRequestData, RequestOption, etc.          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ è¢«æ‰€æœ‰å±‚ä½¿ç”¨
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Presentationâ”‚  â”‚Application â”‚  â”‚Infrastructureâ”‚
â”‚   Layer    â”‚  â”‚   Layer    â”‚  â”‚    Layer     â”‚
â”‚ (handlers) â”‚  â”‚(use-cases) â”‚  â”‚(repositories)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ èŒè´£

### âœ… Types çš„èŒè´£ï¼ˆåº”è¯¥åšä»€ä¹ˆï¼‰
- å®šä¹‰ HTTP è¯·æ±‚/å“åº”çš„æ•°æ®ç»“æ„
- å®šä¹‰æ¶ˆæ¯ã€å¯¹è¯ç­‰æ ¸å¿ƒæ•°æ®ç±»å‹
- å®šä¹‰è·¨å±‚å…±äº«çš„æ¥å£
- æä¾›ç±»å‹å®‰å…¨ä¿éšœ

### âŒ Types ä¸åº”è¯¥åŒ…å«
- âŒ ä¸šåŠ¡é€»è¾‘
- âŒ æ•°æ®è®¿é—®ä»£ç 
- âŒ å…·ä½“å®ç°

## ğŸ“‚ æ–‡ä»¶è¯´æ˜

### `chat.ts` - èŠå¤©ç›¸å…³ç±»å‹å®šä¹‰

```typescript
// èŠå¤©è¯·æ±‚æ•°æ®
export interface ChatRequestData {
  message?: string;
  modelType: 'local' | 'volcano';
  conversationId?: string;
  userId: string;
  deviceId?: string;
  mode?: 'single' | 'multi_agent';
  // ... æ›´å¤šå­—æ®µ
}

// æ¶ˆæ¯å†å²æ¥å£
export interface ChatMessage {
  role: 'system' | 'user' | 'assistant';
  content: string;
}

// è¯·æ±‚é€‰é¡¹ç±»å‹
export interface RequestOption<Q = any, D = any> {
  query?: Q;
  data?: D;
  params?: Record<string, string>;
  headers?: Record<string, string>;
}

// å·¥å…·æ‰§è¡Œç»“æœ
export interface ToolExecutionResult {
  resultText: string;
  sources?: Array<{ title: string; url: string }>;
}
```

## ğŸ”— ä¸ Clean Architecture çš„åä½œ

### 1. Presentation Layer ä½¿ç”¨
```typescript
// api/handlers/sseHandler.ts
import type { ChatMessage } from '../types/chat.js';

async function streamVolcengineToSSEResponse(
  messages: ChatMessage[],  // â† ä½¿ç”¨å…±äº«ç±»å‹
  // ...
) {
  // ...
}
```

### 2. Application Layer ä½¿ç”¨
```typescript
// api/_clean/application/use-cases/text-analysis/process-long-text-analysis.use-case.ts
import type { ChatMessage } from '../../../../types/chat.js';

export class ProcessLongTextAnalysisUseCase {
  async execute(/* ... */) {
    const messages: ChatMessage[] = [  // â† ä½¿ç”¨å…±äº«ç±»å‹
      { role: 'user', content: prompt }
    ];
    // ...
  }
}
```

### 3. Lambda Routes ä½¿ç”¨
```typescript
// api/lambda/chat.ts
import type { ChatRequestData, RequestOption } from '../types/chat.js';

export async function post({
  data,
}: RequestOption<any, ChatRequestData>) {  // â† ä½¿ç”¨å…±äº«ç±»å‹
  // ...
}
```

## ğŸš« ä¸ºä»€ä¹ˆä¸è¿ç§»åˆ° `_clean/`ï¼Ÿ

### åŸå›  1ï¼šClean Architecture å…è®¸å…±äº«ç±»å‹
åœ¨ Clean Architecture ä¸­ï¼Œ**è·¨å±‚å…±äº«çš„æ•°æ®ç»“æ„ï¼ˆDTO/Value Objectsï¼‰** æ˜¯å…è®¸å­˜åœ¨çš„ï¼Œä¸è¿åä¾èµ–è§„åˆ™ã€‚

### åŸå›  2ï¼šé¿å…å¾ªç¯ä¾èµ–
å¦‚æœå°†ç±»å‹å®šä¹‰æ”¾åœ¨ `_clean/` å†…éƒ¨æŸä¸€å±‚ï¼Œå…¶ä»–å±‚å¼•ç”¨æ—¶ä¼šäº§ç”Ÿä¸å¿…è¦çš„å¤æ‚ä¾èµ–ã€‚

### åŸå›  3ï¼šç±»å‹å®šä¹‰çš„ç‰¹æ®Šæ€§
- ç±»å‹å®šä¹‰æ˜¯**ç¼–è¯‘æ—¶**çš„æ¦‚å¿µï¼ˆTypeScript ç¼–è¯‘åæ¶ˆå¤±ï¼‰
- ä¸åŒ…å«è¿è¡Œæ—¶é€»è¾‘
- ä¸ä¼šå½±å“ä¾èµ–å€’ç½®åŸåˆ™

### åŸå›  4ï¼šå®é™…ç»éªŒ
ä¸»æµçš„ Clean Architecture é¡¹ç›®éƒ½ä¼šæœ‰ä¸€ä¸ª **Shared** æˆ– **Common** å±‚ï¼Œç”¨äºå­˜æ”¾è·¨å±‚å…±äº«çš„ç±»å‹ã€å¸¸é‡ã€å·¥å…·å‡½æ•°ã€‚

## ğŸ“š Clean Architecture ä¸­çš„å…±äº«å±‚

Robert C. Martin (Uncle Bob) åœ¨ Clean Architecture ä¹¦ä¸­æåˆ°ï¼š

> "è·¨å±‚å…±äº«çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ DTOsï¼‰å¯ä»¥æ”¾åœ¨ç‹¬ç«‹çš„å…±äº«å±‚ï¼Œè¿™ä¸ä¼šè¿åä¾èµ–è§„åˆ™ï¼Œå› ä¸ºå®ƒä»¬åªæ˜¯æ•°æ®å®¹å™¨ï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ã€‚"

```
å…¸å‹çš„ Clean Architecture åˆ†å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Presentation (Handlers)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Application (Use Cases)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Domain (Entities)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Infrastructure (Repositories)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Shared (Types, Constants, Utils)   â”‚  â† è¢«æ‰€æœ‰å±‚ä½¿ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æœ€ä½³å®è·µ

### âœ… åº”è¯¥æ”¾åœ¨ `api/types/` çš„å†…å®¹
- HTTP è¯·æ±‚/å“åº”çš„æ•°æ®ç»“æ„
- æ¶ˆæ¯ã€å¯¹è¯ç­‰æ ¸å¿ƒæ•°æ®ç±»å‹
- è·¨å±‚å…±äº«çš„æ¥å£
- æšä¸¾ç±»å‹ï¼ˆModelType, MessageRole ç­‰ï¼‰

### âŒ ä¸åº”è¯¥æ”¾åœ¨ `api/types/` çš„å†…å®¹
- ä¸šåŠ¡é€»è¾‘
- æ•°æ®è®¿é—®ä»£ç 
- å…·ä½“å®ç°ç±»

## ğŸ‰ ç»“è®º

**Types ä¸éœ€è¦è¿ç§»ï¼Œå®ƒä»¬æ˜¯ Clean Architecture çš„å…±äº«å±‚ï¼**

è¿™ç§è®¾è®¡ï¼š
- âœ… ç¬¦åˆ Clean Architecture åŸåˆ™
- âœ… é¿å…å¾ªç¯ä¾èµ–
- âœ… æä¾›ç±»å‹å®‰å…¨
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

