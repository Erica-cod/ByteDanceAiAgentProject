1）相似度 / 向量工具（给 Host 判断“吹捧 vs 分歧”）
你之前说：

把每个 agent 的总结向量化，检查相似度，高就证明大家想法一样。

这一步非常适合做成一个独立工具（尤其是你想让模型自己决定什么时候用）。

工具职责
输入：多个短立场摘要（position summary）

输出：

每个摘要的 embedding（可选）

pairwise 相似度矩阵

可以顺便算一下平均相似度、找出最不一样的一对等

工具接口示例
json
复制
{
  "tool": "compare_positions",
  "args": {
    "texts": [
      "AgentA: 结论 + 关键理由...",
      "AgentB: 结论 + 关键理由...",
      "AgentC: 结论 + 关键理由..."
    ]
  }
}
后端实现：

用某个 embedding 模型算 embedding；

算 cosine similarity 矩阵；

返回给模型类似：

json
复制
{
  "embeddings": [[...], [...], [...]],
  "similarity_matrix": [
    [1.0, 0.92, 0.88],
    [0.92, 1.0, 0.81],
    [0.88, 0.81, 1.0]
  ],
  "mean_similarity": 0.90,
  "most_different_pair": [0, 2]
}
谁用这个工具？

主要是 Host：

决定是不是进入收敛阶段

决定要不要强制反方

检测哪个 agent 很顽固（自相似度过高）

普通 Agent 一般不需要。

小建议：embedding 计算和相似度，本身可以全放在后端代码里算。
如果你希望 “由模型自己决定要不要看相似度”，那就包装成这个 compare_positions 工具即可。
主持人实现再参考：
2. Host 如何用“向量 + 规则”来管控讨论？
你说的「把每一个 agent 的总结向量化检查相似度」非常对，但要注意几个细节，否则容易量错东西。

2.1 不要直接嵌整段长文，先“压缩成立场”
建议流程是：

每个 agent 除了长输出，再额外生成一个 立场摘要 position，比如强制 JSON：

json
复制
{
  "conclusion": "我们应该投资项目 X。",
  "key_reasons": [
    "市场增长率 > 20%",
    "竞争对手尚不成熟"
  ],
  "assumptions": [
    "宏观经济不出现剧烈衰退",
    "监管政策保持稳定"
  ],
  "confidence": 0.76
}
Host 只对 conclusion + key_reasons（甚至可以再让模型压成一句话）做 embedding。

这样算出来的相似度更代表“观点是否一致”，而不是“大家都写了很多字”。

2.2 Host 的几条核心规则示例
设每个 agent 在第 t 轮的立场向量是 v_i^t。

检测“大家都在互相吹捧 / 观点高度一致”

计算所有 pairwise cosine similarity 的平均值：

𝑠
𝑖
𝑚
_
𝑚
𝑒
𝑎
𝑛
𝑡
=
mean
𝑖
<
𝑗
cos
⁡
(
𝑣
𝑖
𝑡
,
𝑣
𝑗
𝑡
)
sim_mean 
t
 =mean 
i<j
​
 cos(v 
i
t
​
 ,v 
j
t
​
 )
可以做些规则，比如：

sim_mean^t > 0.9 且已经过了 t >= 1 轮：
→ Host 判断为“高共识”，进入收敛阶段：

要求每个 agent 明确写出：

还剩哪些不确定性

最坏情况是什么

之后直接交给 Reporter 输出结论。

sim_mean^t > 0.9 且所有 agent 的 confidence > 0.8：
→ Host 执行“强制反方环节”：

指定 Devil’s Advocate 或额外再叫一轮“反对角色”：

“请在不引用上轮自己观点的前提下，只从反方角度论证：如果这个结论是错的，最可能的错误点在哪？”

检测“顽固不化”

对每个 agent，自身前后轮做相似度：

𝑠𝑒𝑙𝑓_𝑠𝑖𝑚𝑖𝑡=cos(𝑣𝑖𝑡,𝑣𝑖𝑡−1)self_sim it=cos(v it,v it−1)
如果：

self_sim_i^t > 0.98 （几乎一模一样），

并且至少一个其他 agent 的观点与它相似度 < 0.8（说明有实质性分歧），

那 Host 可以对这个 agent 下“更新命令”：

“你上轮的立场与本轮几乎完全一致，但其他 agent 给出了相反证据。
本轮你必须完成以下至少一个动作：

修改一个关键假设；

降低你的置信度；

明确指出你认为对方论据的逻辑漏洞。”

同时，如果连续多轮 self_sim 都极高，Host 可以降低该 agent 在最终综合中的权重。

时间 / 轮次硬下限

你提到“硬下限靠时间限制”是对的，可以配合这样的策略：

max_rounds 或 max_time 到达后，无论是否完全达成共识：

Host 输出一个“分歧版结论”：

结论 A 及其支持者 + 置信度

结论 B 及其支持者 + 置信度

哪些证据尚未收集、未来需要进一步验证的点

这样不会卡在无休止的争论里。




2）时间 / 日程相关工具（计划型 Bot 非常加分）
做计划一定离不开“时间”：

今天几号？

用户说“下周开始”、“每天晚上 8 点后有空”等怎么落到具体日期？

帮用户按时间轴排任务。

MVP 阶段你可以先做两个小工具：

a. get_now / get_today 工具
json
复制
{
  "tool": "get_now",
  "args": {}
}
返回：

json
复制
{
  "now": "2025-11-26T21:10:00",
  "timezone": "Asia/Shanghai"
}
方便：

Host / Planner 知道当前日期；

帮用户把“下周一”换算成具体日期。